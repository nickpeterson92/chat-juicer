/**
 * Welcome Page Component Styles
 *
 * Welcome container, greeting, input card, suggestion pills,
 * and welcome-specific file handling.
 */

@layer components {

  /* Welcome page components */
  .welcome-container {
    @apply absolute inset-0 flex items-center justify-center z-[100] bg-body-welcome;
  }

  .welcome-content {
    @apply max-w-[720px] w-full px-8 pt-8 pb-12 flex flex-col items-center gap-8 translate-y-[4vh];
  }

  .welcome-header {
    @apply flex flex-col items-center gap-4 relative;
  }

  .welcome-logo {
    @apply absolute -left-[5.5rem] top-1/2 -translate-y-1/2 w-16 h-16 rounded-2xl;
    color: var(--color-welcome-text);
  }

  .welcome-greeting {
    @apply text-3xl font-medium m-0;
    color: var(--color-welcome-text);
    /* GPU acceleration for animations */
    will-change: transform, opacity;
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
  }

  /* Chat page input container */
  .chat-input-section {
    @apply w-full flex flex-col gap-3 rounded-3xl py-5 px-6 transition-all;
    background-color: var(--color-surface-1);
    border: 1px solid var(--color-border-secondary);
  }

  .chat-input-section:focus-within {
    border-color: var(--color-border-focus);
  }

  /* Compact variant for chat page - minimal padding */
  .chat-input-section.compact {
    @apply gap-0 py-1 px-2 rounded-lg;
    background-color: var(--color-surface-2);
  }

  /* =========================================
   * SIBLING ARCHITECTURE (Files & Input Decoupled)
   * ========================================= */

  /* 1. The Wrapper Card (Visual Shell) */
  .welcome-input-card {
    @apply w-full flex flex-col rounded-3xl transition-all gap-0;
    /* Explicit gap-0 */
    background-color: var(--color-surface-1);
    border: 1px solid var(--color-border-secondary);

    /* Allow model selector/attachment menu to pop out */
    overflow: visible;
    /* Wrapper has NO padding. Siblings manage their own spacing. */
    padding: 0;
  }

  .welcome-input-card:focus-within {
    border-color: var(--color-border-focus);
  }

  /* 2. Sibling One: Files Drawer */
  .welcome-files-drawer {
    /* DEFAULT: Completely removed from layout */
    display: none;
    /* Collapsed state is 0fr */
    grid-template-rows: 0fr;
    /* ELITE ANIMATION: Animate display property properly */
    transition:
      grid-template-rows 300ms cubic-bezier(0.4, 0, 0.2, 1),
      display 300ms step-end allow-discrete;
    background: transparent;
    width: 100%;
    /* CRITICAL: Ensure child padding doesn't leak */
    overflow: hidden;
    margin: 0;
    padding: 0;
    min-height: 0;
    /* Ensures grid track can collapse fully to 0 */
  }

  /* State: Has files (expanded) */
  .welcome-input-card.has-files .welcome-files-drawer {
    display: grid;
    grid-template-rows: 1fr;
    /* Enter transition: Display snaps to grid immediately */
    transition:
      grid-template-rows 300ms cubic-bezier(0.4, 0, 0.2, 1),
      display 0s step-start allow-discrete;
  }

  /* Entry Animation Hook */
  @starting-style {
    .welcome-input-card.has-files .welcome-files-drawer {
      grid-template-rows: 0fr;
    }
  }

  .welcome-files-list {
    min-height: 0;
    /* Default: 0 padding to ensure total collapse */
    padding: 0;
    /* CRITICAL for Grid Animation: clip content when 0fr */
    overflow: hidden;
    transition: padding 300ms cubic-bezier(0.4, 0, 0.2, 1);

    /* Horizontal scrolling layout for file cards */
    @apply rounded-lg flex flex-row gap-2 w-full;
    background-color: transparent;
    border: none;
    overflow-x: auto;
    overflow-y: hidden;
    padding-bottom: 8px;
    /* Space for scrollbar */
    scrollbar-width: thin;
  }

  /* State: Has files (Add padding to list) */
  .welcome-input-card.has-files .welcome-files-list {
    /* Internal spacing: 12px all around (top only, no bottom) */
    padding: 12px 12px 0 12px;
  }

  /* 3. Sibling Two: Text Area Wrapper */
  .welcome-text-area {
    @apply w-full flex flex-col;

    /* NO TRANSITION: Padding snaps instantly to avoid conflicting with drawer animation */
    /* The drawer slide is the only visible motion, creating smooth UX */

    /* BASE STATE: Spacious padding (20px all sides) */
    padding: 20px;
  }

  /* State: Tighter when files are present */
  .welcome-input-card.has-files .welcome-text-area {
    /* Uniform 12px padding */
    padding: 12px;
  }

  .welcome-input-footer {
    @apply grid grid-cols-[1fr_auto_auto] grid-rows-1 items-center gap-1.5 pt-1;
  }

  /* Chat input footer (compact variant) - + button left, controls right */
  .chat-input-section.compact .chat-input-footer {
    @apply flex items-center gap-1.5 pt-1;
  }

  /* Right-side controls wrapper (model selector + send button) */
  .chat-controls-right {
    @apply flex items-center gap-1.5 ml-auto;
  }

  /* MCP toggle buttons container - horizontal layout */
  .mcp-toggle-buttons {
    @apply flex items-center gap-1.5 flex-shrink-0 col-start-1 row-start-1 row-end-3 self-center;
    /* Pull left to reduce gap between + button and container edge */
    margin-left: -14px;
  }

  /* Compact chat variant: adjust for smaller container padding (px-2 = 8px) */
  .chat-input-section.compact .mcp-toggle-buttons {
    margin-left: -2px;
  }

  .welcome-input {
    @apply w-full max-h-[200px] border-none outline-none bg-transparent text-base leading-[1.625] resize-none overflow-y-auto py-1 px-0;
    min-height: var(--input-min-height);
    color: var(--color-text-primary);
    scrollbar-color: var(--color-scrollbar-thumb) transparent;
    scrollbar-width: thin;
  }

  .welcome-input::-webkit-scrollbar {
    width: 6px;
  }

  .welcome-input::-webkit-scrollbar-track {
    background: transparent;
  }

  .welcome-input::-webkit-scrollbar-thumb {
    background-color: var(--color-scrollbar-thumb);
    border-radius: 3px;
  }

  .welcome-input::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-scrollbar-thumb-hover);
  }

  .welcome-input::placeholder {
    color: var(--color-text-secondary);
    opacity: 0.6;
  }

  /* Compact variant - very small min height, tight text */
  .chat-input-section.compact .chat-input {
    @apply text-sm leading-[1.3] py-1.5;
    min-height: var(--input-min-height);
    background-color: var(--color-surface-2);
    color: var(--color-text-user);
  }

  .welcome-send-btn {
    @apply flex items-center justify-center w-11 h-11 border-none rounded-full cursor-not-allowed transition-all;
    background-color: var(--color-surface-active);
    color: var(--color-text-user);
    opacity: 0.5;
  }

  .welcome-send-btn.ready {
    @apply cursor-pointer;
    background-color: var(--color-brand-primary);
    color: var(--color-text-user);
    opacity: 1;
  }

  .welcome-send-btn.ready:hover {
    transform: translateY(-1px);
  }

  .welcome-send-btn.ready:active {
    transform: translateY(0);
  }

  .welcome-send-btn:disabled {
    @apply opacity-100;
  }

  /* Compact send button (chat container only) - smaller 28x28 with 16x16 icon */
  .chat-input-section.compact .welcome-send-btn {
    @apply w-7 h-7;
  }

  .chat-input-section.compact .welcome-send-btn svg {
    @apply w-4 h-4;
  }

  /* ==========================================
   * PILL THEME SYSTEM
   * Single unified pill theme for all contexts
   * ========================================== */

  :root {
    --pill-bg: transparent;
    --pill-bg-hover: var(--color-surface-hover);
    --pill-border: var(--color-border-secondary);
    --pill-border-hover: var(--color-border-hover);
    --pill-text: var(--color-text-secondary);
    --pill-text-hover: var(--color-text-primary);
    --pill-backdrop: none;
    --pill-focus-ring: var(--color-brand-primary);
    --pill-focus-border: var(--color-border-focus);
    --pill-hover-transform: translateY(-1px);
  }

  /* ==========================================
   * PILL STYLES - Single source of truth
   * ========================================== */

  .suggestion-pills {
    @apply flex gap-2 flex-wrap justify-center mt-2;
  }

  .suggestion-pill {
    @apply flex items-center gap-1.5 py-2 px-3 rounded-lg text-sm font-[450] cursor-pointer transition-all whitespace-nowrap;
    background-color: var(--pill-bg);
    border: 1px solid var(--pill-border);
    color: var(--pill-text);
    backdrop-filter: var(--pill-backdrop);
    /* GPU acceleration for animations */
    will-change: transform, opacity;
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
  }

  /* Pre-hide pills before animation runs to prevent flash during view transitions */
  .suggestion-pill.pills-pre-animate {
    opacity: 0;
    transform: translate3d(-30px, 0, 0);
  }

  .suggestion-pill:hover {
    background-color: var(--pill-bg-hover);
    color: var(--pill-text-hover);
    transform: var(--pill-hover-transform);
    /* Use custom property set by animation for vibrant color pop */
    border-color: var(--pill-color-vibrant, var(--pill-border-hover));
  }

  /* Individual pill hover colors - positional for flexibility */
  .suggestion-pill:nth-child(1):hover {
    border-color: var(--color-brand-accent-1);
    /* Lime green */
  }

  .suggestion-pill:nth-child(2):hover {
    border-color: var(--color-brand-accent-2);
    /* Light purple */
  }

  .suggestion-pill:nth-child(3):hover {
    border-color: var(--color-brand-accent-3);
    /* Coral red */
  }

  .suggestion-pill:nth-child(4):hover {
    border-color: var(--color-brand-accent-4);
    /* Cyan */
  }

  .suggestion-pill:nth-child(5):hover {
    border-color: var(--color-brand-accent-5);
    /* Dark blue */
  }

  .suggestion-pill:active {
    color: var(--pill-text-hover);
    transform: translateY(0);
  }

  /* Focus indicator for accessibility (WCAG 2.4.7 AA) */
  .suggestion-pill:focus-visible {
    box-shadow: 0 0 0 3px var(--pill-focus-ring);
    outline: 2px solid transparent;
    /* High contrast mode fallback */
    opacity: 1;
    /* Ensure pill is visible when focused during animation */
    border-color: var(--pill-focus-border);
  }

  .pill-icon {
    @apply w-4 h-4 flex items-center justify-center flex-shrink-0 transition-opacity;
    opacity: 0.7;
  }

  .suggestion-pill:hover .pill-icon {
    opacity: 0.95;
  }

  .pill-icon svg {
    @apply w-4 h-4;
  }

  .model-info {
    @apply mt-4 py-2 px-4 rounded-2xl text-sm font-medium;
    background-color: var(--color-surface-1);
    color: var(--color-text-secondary);
  }

  /* ==========================================
   * COLOR UTILITY CLASSES
   * Convenience classes for semantic tokens
   * ========================================== */

  /* Background utilities */
  .bg-surface-1 {
    background-color: var(--color-surface-1);
  }

  .bg-surface-2 {
    background-color: var(--color-surface-2);
  }

  .welcome-files-section {
    @apply mt-8 w-full max-w-[600px];
  }

  .welcome-files-header {
    @apply flex items-center justify-between mb-3 px-1;
  }

  .welcome-files-title {
    @apply text-sm font-semibold;
    color: var(--color-text-secondary);
  }

  .welcome-files-refresh-btn {
    @apply bg-none border-none p-1 cursor-pointer rounded transition-all flex items-center justify-center;
    color: var(--color-text-secondary);
  }

  .welcome-files-refresh-btn:hover {
    background-color: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  /* Force thumbnail grid to behave as a flex row when inside welcome files */
  .welcome-files-list .thumbnail-grid {
    display: flex;
    flex-direction: row;
    gap: 12px;
    grid-template-columns: unset;
    width: max-content;
  }

  /* Stack files horizontally */
  .welcome-files-list .thumbnail-card {
    flex-shrink: 0;
    width: 100px;
    height: 100px;
  }

  .welcome-files-list .file-item {
    @apply py-2 px-3 mb-1 last:mb-0;
  }

  .welcome-files-list .files-loading,
  .welcome-files-list .files-error,
  .welcome-files-list .files-empty {
    @apply text-center p-4 text-sm;
    color: var(--color-text-secondary);
  }
}
