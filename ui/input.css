@import "tailwindcss";

/* NOTE: @theme block removed - brand colors defined in @layer base :root section
 * Tailwind v4 can use CSS custom properties directly via arbitrary values
 * Keyframe animations moved to @layer base for better organization
 */

/* Essential custom CSS - Platform-specific features and complex patterns */
@layer components {
  /* ==========================================
   * PLATFORM-SPECIFIC: macOS window dragging
   * ========================================== */
  .macos-drag-handle {
    -webkit-app-region: drag;
    position: fixed;
    top: 0;
    left: 260px;  /* Exclude sidebar when expanded */
    right: 420px; /* Exclude file panel when expanded */
    height: 32px;
    z-index: 10000;
    background: transparent;
    pointer-events: auto;
  }

  /* Extend drag handle when sidebar is collapsed */
  body:has(#sidebar.collapsed) .macos-drag-handle {
    left: 0;
  }

  /* Extend drag handle when file panel is collapsed */
  body:has(#files-panel.collapsed) .macos-drag-handle {
    right: 0;
  }

  body:has(.custom-titlebar) .macos-drag-handle {
    display: none;
  }

  #sidebar-toggle,
  #settings-btn,
  #restart-btn,
  #open-files-btn,
  #files-panel > div:first-child {
    -webkit-app-region: no-drag;
    position: relative;
    z-index: 10001;
  }

  /* ==========================================
   * PLATFORM-SPECIFIC: Custom titlebar (Windows/Linux)
   * ========================================== */
  .custom-titlebar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 32px;
    background: var(--color-surface-2);
    display: flex;
    align-items: center;
    justify-content: space-between;
    user-select: none;
    z-index: 10000;
    border-bottom: 1px solid var(--color-border-secondary);
    transition:
      background-color 0.2s,
      border-color 0.2s;
  }

  .titlebar-drag-region {
    -webkit-app-region: drag;
    flex: 1;
    height: 100%;
    display: flex;
    align-items: center;
    padding-left: 12px;
  }

  .titlebar-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--color-text-secondary);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }

  .titlebar-controls {
    -webkit-app-region: no-drag;
    display: flex;
    height: 100%;
  }

  .titlebar-button {
    width: 46px;
    height: 100%;
    border: none;
    background: transparent;
    color: var(--color-text-secondary);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition:
      background-color 0.15s,
      color 0.15s;
    padding: 0;
    margin: 0;
  }

  .titlebar-button:hover {
    background: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  .titlebar-close:hover {
    background: var(--color-status-error);
    color: var(--color-text-user);
  }

  .titlebar-button svg {
    width: 10px;
    height: 10px;
  }

  body:has(.custom-titlebar) {
    padding-top: 32px;
  }

  /* ==========================================
   * PANEL ALIGNMENT: Ensure full-height panels align properly
   * Both session panel (sidebar) and file panel extend full height
   * and need to account for custom titlebar on Windows/Linux
   * ========================================== */

  /* Session panel first button - push down to account for titlebar */
  body:has(.custom-titlebar) #sidebar > button:first-of-type {
    margin-top: 44px; /* 32px titlebar + 12px original margin */
  }

  /* File panel header - push down to account for titlebar on Windows/Linux */
  body:has(.custom-titlebar) #files-panel > div:first-child {
    margin-top: 32px; /* Account for custom titlebar */
  }

  /* ==========================================
   * SCROLL ANCHORING for chat container
   * Prevents layout shift when Mermaid diagrams expand
   * ========================================== */
  #chat-container {
    overflow-anchor: auto;
  }

  /* ==========================================
   * CUSTOM SCROLLBARS (not available in Tailwind)
   * ========================================== */
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: var(--color-scrollbar-thumb);
    border-radius: 0.25rem;
  }


  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-scrollbar-thumb-hover);
  }

  /* Firefox scrollbar styling */
  .custom-scrollbar {
    scrollbar-color: var(--color-scrollbar-thumb) transparent;
    scrollbar-width: thin;
  }

  .sessions-scrollbar::-webkit-scrollbar {
    width: 6px;
  }

  .sessions-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .sessions-scrollbar::-webkit-scrollbar-thumb {
    background-color: var(--color-scrollbar-thumb);
    border-radius: 0.125rem;
  }


  .sessions-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-scrollbar-thumb-hover);
  }

  /* Firefox scrollbar styling */
  .sessions-scrollbar {
    scrollbar-color: var(--color-scrollbar-thumb) transparent;
    scrollbar-width: thin;
  }

  /* ==========================================
   * DYNAMICALLY CREATED COMPONENTS
   * Minimal classes for JavaScript-generated elements
   * ========================================== */

  /* Session items in sidebar */
  .session-item {
    @apply p-3 mb-1 rounded-lg cursor-pointer text-sm transition-all duration-200 flex items-center justify-between gap-2;
    color: var(--color-text-primary);
    background-color: transparent;
    border: 1px solid transparent;
  }

  .session-item:hover {
    background-color: var(--color-surface-hover);
    border-color: var(--color-brand-primary);
    transform: translateX(2px);
    box-shadow: 0 0 0 2px var(--color-brand-glow);
  }

  .session-item.active {
    background-color: var(--color-brand-primary);
    color: var(--color-text-user);
  }

  /* Streaming indicator container (Lottie animation) */
  .session-streaming-indicator {
    display: none; /* Hidden by default */
    position: absolute;
    left: 0.25rem;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  /* Show indicator for streaming background sessions */
  .session-item.session-streaming {
    position: relative;
    padding-left: 1.5rem; /* Make room for indicator */
  }

  .session-item.session-streaming .session-streaming-indicator {
    display: block;
  }

  /* Hide indicator for active sessions (they use main chat streaming UI) */
  .session-item.session-streaming.active .session-streaming-indicator {
    display: none;
  }

  /* Active streaming session doesn't need extra padding */
  .session-item.session-streaming.active {
    padding-left: 0.75rem;
  }

  .session-title {
    @apply overflow-hidden text-ellipsis whitespace-nowrap;
    max-width: 240px; /* Allow longer titles when actions are hidden */
  }

  .session-content {
    @apply flex-1 min-w-0 flex flex-col;
  }

  .session-timestamp {
    @apply text-xs mt-0.5;
  }

  .session-actions {
    @apply flex gap-1 opacity-0 transition-opacity duration-200 flex-shrink-0;
    max-width: 0;
    overflow: hidden;
    pointer-events: none;
  }

  .session-item:hover .session-actions {
    @apply opacity-100;
    max-width: 180px;
    pointer-events: auto;
  }

  .session-action-btn {
    @apply bg-transparent border-none cursor-pointer p-1.5 rounded inline-flex items-center justify-center;
  }

  .session-action-btn svg {
    @apply transition-colors duration-150;
    transition: color 150ms ease, transform 150ms ease;
    color: var(--color-text-on-surface, #ffffff); /* default for all icons */
  }

  /* Rename button - Light purple (matches pill accent-2) */
  .session-action-btn.rename-btn:hover svg {
    color: var(--color-text-secondary);
    @apply stroke-current;
  }

  /* Delete button hover keeps warning color */
  .session-action-btn.delete-btn:hover svg {
    color: var(--color-brand-accent-3);
    @apply stroke-current;
  }

  /* Pin button stateful styling */
  .session-action-btn.pin-btn svg {
    color: var(--color-text-on-surface, #ffffff); /* default matches rename for unpinned */
    @apply stroke-current;
  }

  /* Hover: light gray to match rename */
  .session-action-btn.pin-btn:hover svg {
    color: var(--color-text-secondary);
  }

  /* Pinned default: brand accent 5 */
  .session-item.session-pinned .session-action-btn.pin-btn svg {
    color: var(--color-brand-accent-5);
  }

  /* Pinned hover: keep brand color and scale cue */
  .session-item.session-pinned .session-action-btn.pin-btn:hover svg {
    color: var(--color-brand-accent-5);
    filter: brightness(1.12);
    transform: scale(1.08);
  }

  /* Gentle hover scale for all session action icons */
  .session-action-btn:hover svg {
    transform: scale(1.05);
  }

  .session-title-edit {
    font-family: inherit;
    background: var(--color-surface-3);
    color: var(--color-text-primary);
    border-color: var(--color-brand-primary);
  }

  .load-more-sessions-btn {
    @apply w-full py-2.5 px-3 mt-2 bg-transparent rounded-lg text-[13px] font-medium cursor-pointer transition-all text-center disabled:opacity-50 disabled:cursor-not-allowed;
    border: 1px solid var(--color-border-secondary);
    color: var(--color-text-primary);
  }

  .load-more-sessions-btn:hover {
    background-color: var(--color-surface-hover);
    border-color: var(--color-brand-primary);
    color: var(--color-brand-primary);
  }

  /* Empty session list state */
  .session-list-empty {
    @apply flex flex-col items-center justify-center py-12 px-4 text-center;
  }

  .empty-icon {
    @apply mb-3;
    color: var(--color-text-secondary);
  }

  .empty-message {
    @apply text-sm;
    color: var(--color-text-secondary);
  }

  /* Function call disclosure cards (Claude Code style) */
  .function-disclosure {
    @apply my-1.5 text-sm;
    animation: fadeIn 0.2s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Disclosure header - clickable row */
  .disclosure-header {
    @apply inline-flex items-center gap-1.5 cursor-pointer py-0.5 px-0;
    transition: opacity 0.15s ease;
  }

  .disclosure-header:hover {
    opacity: 0.8;
  }

  /* Tool icon - small, subtle */
  .disclosure-icon {
    @apply inline-flex items-center justify-center w-4 h-4 flex-shrink-0;
    color: var(--color-text-secondary);
    opacity: 0.7;
  }

  .disclosure-icon svg {
    @apply w-3.5 h-3.5;
  }

  /* Tool name - prominent */
  .disclosure-tool-name {
    @apply font-medium;
    color: var(--color-text-secondary);
  }

  /* Args preview - less prominent, space-separated from tool name */
  /* Hidden initially, fades in gracefully when args arrive */
  .disclosure-args-preview {
    @apply font-normal text-sm max-w-[400px] overflow-hidden text-ellipsis whitespace-nowrap;
    color: var(--color-text-secondary);
    opacity: 0;
    transition: opacity 0.3s ease-out;
  }

  .disclosure-args-preview.visible {
    opacity: 0.7;
  }

  /* Chevron indicator - hidden until there's content to expand */
  .disclosure-chevron {
    @apply inline-flex items-center justify-center ml-0.5 flex-shrink-0;
    color: var(--color-text-secondary);
    opacity: 0;
    transition: opacity 0.3s ease-out, transform 0.2s ease;
  }

  .disclosure-chevron.visible {
    opacity: 0.5;
  }

  .disclosure-chevron svg {
    @apply w-3 h-3;
  }

  .function-disclosure.expanded .disclosure-chevron {
    transform: rotate(0deg);
  }

  /* Status-based styling - only highlight errors/interrupts, keep everything else chill */
  .function-disclosure[data-status="error"] .disclosure-tool-name {
    color: var(--color-status-error);
  }

  .function-disclosure[data-status="interrupted"] .disclosure-tool-name {
    text-decoration: line-through;
    text-decoration-color: var(--color-text-secondary);
    opacity: 0.7;
  }

  /* In-progress shimmer animation - wave that lights up letters left to right */
  @keyframes shimmer-wave {
    from {
      background-position: 200% center;
    }
    to {
      background-position: -200% center;
    }
  }

  /* Apply shimmer to all in-progress states */
  .function-disclosure[data-status="preparing"] .disclosure-tool-name,
  .function-disclosure[data-status="preparing..."] .disclosure-tool-name,
  .function-disclosure[data-status="ready"] .disclosure-tool-name,
  .function-disclosure[data-status="streaming"] .disclosure-tool-name,
  .function-disclosure[data-status="executing..."] .disclosure-tool-name {
    background: linear-gradient(
      90deg,
      var(--color-text-secondary) 0%,
      var(--color-text-secondary) 40%,
      var(--color-text-primary) 50%,
      var(--color-text-secondary) 60%,
      var(--color-text-secondary) 100%
    );
    background-size: 200% 100%;
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shimmer-wave 2s ease-in-out infinite;
  }

  /* Expandable content container */
  .disclosure-content {
    @apply hidden mt-2 ml-0 pl-3 border-l-2;
    border-color: var(--color-border-secondary);
  }

  .function-disclosure.expanded .disclosure-content {
    @apply block;
  }

  /* Section labels (Arguments, Result, Thinking) */
  .disclosure-section-label {
    @apply text-xs font-semibold uppercase tracking-wider mb-1;
    color: var(--color-text-secondary);
    opacity: 0.7;
  }

  /* Section content (pre-formatted) */
  .disclosure-section-content {
    @apply font-mono text-xs rounded-md p-3 mb-2 max-h-[250px] overflow-y-auto overflow-x-auto whitespace-pre-wrap break-words;
    background: var(--color-surface-3);
    color: var(--color-text-on-surface);
  }

  /* Syntax highlighted content */
  .disclosure-section-content.hljs {
    background: var(--color-surface-3);
  }

  .disclosure-section-content.streaming {
    opacity: 0.7;
  }

  /* Reasoning section (thinking) */
  .disclosure-reasoning {
    @apply mb-2;
  }

  .disclosure-reasoning-content {
    @apply text-sm leading-relaxed;
    color: var(--color-text-secondary);
  }

  /* Result section */
  .disclosure-result .disclosure-section-content {
    @apply max-h-[400px];
  }

  /* Error section */
  .disclosure-error .disclosure-section-content {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  .disclosure-error .error-text {
    color: var(--color-status-error);
  }

  /* Arguments section */
  .disclosure-arguments .disclosure-section-content {
    @apply max-h-[250px];
  }

  /* Code input display (Python code in arguments) */
  .code-input-section .code-input-display {
    @apply font-mono text-sm rounded-md p-4 max-h-[400px] overflow-y-auto overflow-x-auto;
    background: var(--color-surface-3);
    line-height: 1.5;
  }

  .code-input-display code.hljs {
    background: transparent;
    padding: 0;
  }

  /* ==========================================
   * CODE INTERPRETER OUTPUT STYLING
   * ========================================== */

  /* Main container for code interpreter output */
  .code-interpreter-output {
    @apply flex flex-col gap-3;
  }

  /* Output section wrapper */
  .code-output-section {
    @apply mb-2;
  }

  /* Terminal output styling (stdout/stderr) */
  .code-output-terminal {
    @apply font-mono text-xs rounded-md p-3 max-h-[300px] overflow-y-auto overflow-x-auto whitespace-pre-wrap break-words;
    background: var(--color-surface-3);
    color: var(--color-text-on-surface);
  }

  /* Error output specific styling */
  .code-output-section.code-output-error .code-output-terminal {
    color: var(--color-status-error);
    border-left: 3px solid var(--color-status-error);
  }

  /* Generated files container */
  .code-output-files {
    @apply flex flex-col gap-2;
  }

  /* Image container */
  .code-output-image-container {
    @apply rounded-lg overflow-hidden;
    background: var(--color-surface-2);
    border: 1px solid var(--color-border-secondary);
  }

  .code-output-image {
    @apply w-full h-auto max-h-[400px] object-contain;
    display: block;
  }

  .code-output-image-caption {
    @apply text-xs py-2 px-3;
    color: var(--color-text-secondary);
    background: var(--color-surface-overlay);
    border-top: 1px solid var(--color-border-secondary);
  }

  /* File download item */
  .code-output-file-item {
    @apply flex items-center gap-2.5 py-2.5 px-3 rounded-lg;
    background: var(--color-surface-2);
    border: 1px solid var(--color-border-secondary);
  }

  .code-output-file-item:hover {
    border-color: var(--color-border-hover);
  }

  .code-output-file-icon {
    @apply flex-shrink-0 flex items-center justify-center w-8 h-8;
    color: var(--color-text-secondary);
  }

  .code-output-file-icon svg {
    @apply w-5 h-5;
  }

  .code-output-file-info {
    @apply flex-1 flex flex-col gap-0.5;
  }

  .code-output-file-name {
    @apply text-sm font-medium;
    color: var(--color-text-primary);
  }

  .code-output-file-size {
    @apply text-xs;
    color: var(--color-text-secondary);
  }

  .code-output-download-btn {
    @apply flex-shrink-0 flex items-center justify-center w-8 h-8 p-0 border-none rounded bg-transparent cursor-pointer transition-all;
    color: var(--color-text-secondary);
  }

  .code-output-download-btn:hover {
    background: var(--color-surface-hover);
    color: var(--color-brand-primary);
  }

  .code-output-download-btn svg {
    @apply w-4 h-4;
  }

  /* Execution metadata footer */
  .code-output-meta {
    @apply text-xs mt-2;
    color: var(--color-text-secondary);
    opacity: 0.7;
  }

  /* ==========================================
   * BREADCRUMB NAVIGATION (Phase 2)
   * ========================================== */
  .breadcrumb-nav {
    @apply flex items-center gap-1 py-3 px-0 mb-2 flex-wrap;
    border-bottom: 1px solid var(--color-border-secondary);
  }

  .breadcrumb-segment {
    @apply bg-transparent border-none py-1 px-2 rounded-md text-sm cursor-pointer transition-all;
    color: var(--color-text-secondary);
  }

  .breadcrumb-segment:hover:not(:disabled):not(.active) {
    background-color: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  .breadcrumb-segment.active {
    color: var(--color-text-primary);
    font-weight: 600;
    cursor: default;
  }

  .breadcrumb-segment:disabled {
    cursor: default;
  }

  .breadcrumb-separator {
    @apply select-none text-sm;
    color: var(--color-text-secondary);
  }

  /* ==========================================
   * FILE PANEL TABS
   * Sleek underline-style tabs
   * ========================================== */
  .file-panel-tabs {
    @apply flex gap-1;
    border-bottom: 1px solid var(--color-border-secondary);
    padding-bottom: 0;
  }

  .file-panel-tab {
    @apply bg-transparent border-none py-2 px-3 text-[13px] font-medium cursor-pointer transition-all duration-150 flex items-center gap-1.5;
    color: var(--color-text-secondary);
    position: relative;
  }

  .file-panel-tab::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: transparent;
    transition: background 0.15s ease;
  }

  .file-panel-tab:hover {
    color: var(--color-text-primary);
  }

  .file-panel-tab.active {
    color: var(--color-text-primary);
  }

  .file-panel-tab.active::after {
    background: var(--color-text-primary);
  }

  .file-panel-tab svg {
    @apply w-3.5 h-3.5;
  }

  /* ==========================================
   * FOLDER ITEMS (Phase 2)
   * ========================================== */
  .folder-item {
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .folder-item:hover {
    border-color: var(--color-brand-primary);
  }

  .folder-item .file-icon {
    color: var(--color-text-secondary);
  }

  .folder-name {
    font-weight: 500;
  }

  .folder-count {
    @apply ml-auto text-xs py-0.5 px-2 rounded-md;
    color: var(--color-text-secondary);
    background-color: var(--color-surface-overlay);
  }

  /* File items should not have delete button visible for folders */
  .folder-item .file-delete-btn {
    display: none;
  }

  /* ==========================================
   * FILE ITEMS
   * ========================================== */
  .file-item {
    @apply flex items-center gap-2.5 py-2.5 px-3 border rounded-lg transition-all cursor-pointer select-none active:scale-[0.98];
    background-color: var(--color-surface-2);
    border-color: var(--color-border-secondary);
  }

  .file-item:hover {
    border-color: var(--color-brand-primary);
  }

  .file-icon {
    @apply text-lg flex-shrink-0 flex items-center justify-center;
    color: var(--color-text-secondary);
  }

  .file-name {
    @apply flex-1 text-[13px] overflow-hidden text-ellipsis whitespace-nowrap font-medium;
    color: var(--color-text-primary);
  }

  .file-size {
    @apply text-[11px] flex-shrink-0;
    color: var(--color-text-secondary);
  }

  .file-delete-btn {
    @apply bg-transparent border-none cursor-pointer p-1 rounded text-sm opacity-0 flex-shrink-0;
    color: var(--color-text-secondary);
  }

  .file-delete-btn svg {
    @apply transition-colors duration-150;
  }

  .file-item:hover .file-delete-btn {
    @apply opacity-100;
  }

  .file-delete-btn:hover svg {
    color: var(--color-status-error);
  }

  /* Welcome page components */
  .welcome-container {
    @apply absolute inset-0 flex items-center justify-center z-[100];
  }

  /* ==========================================
   * ACCESSIBILITY: Screen reader only elements
   * Visually hidden but available to assistive tech
   * ========================================== */
  .sr-only {
    @apply absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap;
    border: 0;
    clip: rect(0, 0, 0, 0);
  }

  /* ==========================================
   * PARTIAL RESPONSE INDICATOR
   * Visual indicator for interrupted/incomplete responses
   * ========================================== */

  /* Partial/interrupted response styling */
  .message-partial {
    position: relative;
    padding-left: 12px; /* Make room for warning bar */
  }

  .message-partial .message-content::after {
    content: " [interrupted]";
    color: var(--color-text-secondary);
    font-style: italic;
    font-size: 0.85em;
    opacity: 0.8;
  }

  .message-partial::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--color-status-warning);
    border-radius: 2px;
  }

  /* ==========================================
   * STREAM INTERRUPT FEATURE
   * Styles for stop button during streaming
   * ========================================== */

  /* Send button streaming state - keep blue, show stop icon */
  #send-btn.streaming {
    cursor: pointer;
    position: relative;
  }

  /* Hide the arrow SVG when streaming */
  #send-btn.streaming svg {
    display: none;
  }

  /* Stop square icon centered (no circle) */
  #send-btn.streaming::after {
    content: "";
    position: absolute;
    width: 8px;
    height: 8px;
    background-color: currentColor;
    border-radius: 1px;
  }

  /* Stopping state - reduced opacity while interrupt processes */
  #send-btn.stopping {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* ==========================================
   * MESSAGE QUEUE FEATURE
   * Styles for queued messages while agent is processing
   * ========================================== */

  /* Queue count badge on send button area */
  .queue-count-badge {
    @apply absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 text-[10px] font-bold rounded-full flex items-center justify-center;
    background-color: var(--color-brand-primary);
    color: var(--color-text-user);
    animation: queueBadgePop 0.2s ease-out;
  }

  @keyframes queueBadgePop {
    0% {
      transform: scale(0);
      opacity: 0;
    }
    50% {
      transform: scale(1.2);
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  /* Queued message card styling */
  .queued-message {
    animation: queuedMessageSlideIn 0.2s ease-out;
  }

  @keyframes queuedMessageSlideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Queued message removal animation (slide up) */
  .queued-message.removing {
    animation: queuedMessageSlideOut 0.15s ease-in forwards;
  }

  @keyframes queuedMessageSlideOut {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-10px);
    }
  }

  /* Queued message cancel animation (elegant slide/fade left to right) */
  .queued-message.queue-cancel-animate {
    animation: queueCancelSlide 0.3s ease-out forwards;
    pointer-events: none;
  }

  @keyframes queueCancelSlide {
    0% {
      opacity: 1;
      transform: translateX(0);
    }
    100% {
      opacity: 0;
      transform: translateX(100px);
    }
  }

  /* Queued message card hover state */
  .queued-message-card:hover {
    opacity: 0.85 !important;
  }

  /* Edit mode styling for queued message */
  .queued-message-card.editing {
    opacity: 1 !important;
    border-style: solid !important;
    border-color: var(--color-brand-primary) !important;
  }

  .welcome-content {
    @apply max-w-[720px] w-full px-8 pt-8 pb-12 flex flex-col items-center gap-8 translate-y-[4vh];
  }

  .welcome-header {
    @apply flex flex-col items-center gap-4 relative;
  }

  .welcome-logo {
    @apply absolute -left-[5.5rem] top-1/2 -translate-y-1/2 w-16 h-16 rounded-2xl;
    color: var(--color-welcome-text);
  }

  .welcome-greeting {
    @apply text-3xl font-medium m-0;
    color: var(--color-welcome-text);
    /* GPU acceleration for animations */
    will-change: transform, opacity;
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
  }

  .welcome-input-section {
    @apply w-full flex flex-col gap-3 rounded-3xl py-5 px-6 transition-all;
    background-color: var(--color-surface-1);
    border: 1px solid var(--color-border-secondary);
  }

  .welcome-input-section:focus-within {
    border-color: var(--color-border-focus);
  }

  /* Compact variant for chat page - absolute minimal padding */
  .welcome-input-section.compact {
    @apply gap-0 py-1 px-2 rounded-lg;
    background-color: var(--color-surface-2);
  }

  .welcome-input-footer {
    @apply grid grid-cols-[1fr_auto_auto] grid-rows-1 items-center gap-1.5 pt-2;
  }

  /* Compact variant - simplified layout, controls on right */
  .welcome-input-section.compact .welcome-input-footer {
    @apply pt-0 gap-1.5 grid-cols-[1fr_auto_auto] grid-rows-1;
  }

  /* Model selector in compact mode goes to column 2 */
  .welcome-input-section.compact .model-config-inline {
    @apply col-start-2 row-start-1;
  }

  /* Send button in compact mode goes to column 3 */
  .welcome-input-section.compact .welcome-send-btn {
    @apply col-start-3 row-start-1;
  }

  .mcp-toggle-buttons {
    @apply flex items-center gap-1.5 flex-shrink-0 col-start-1 row-start-1 row-end-3 self-center;
  }

  /* Wrapper for model selector to enable relative positioning */
  .model-config-inline {
    @apply relative flex flex-col items-end gap-1 flex-shrink-0 col-start-2 row-start-1;
  }

  .model-selector-trigger {
    @apply flex items-center gap-1.5 py-1.5 px-3 border-none rounded-lg bg-transparent text-sm font-medium cursor-pointer transition-colors;
    color: var(--color-text-secondary);
  }

  .model-selector-trigger:hover {
    background-color: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  /* Compact variant - smaller model selector trigger */
  .welcome-input-section.compact .model-selector-trigger {
    @apply py-1 px-2 text-xs;
  }

  .model-selector-trigger svg {
    @apply w-4 h-4 transition-transform;
  }

  .model-selector-dropdown {
    @apply absolute right-0 w-[300px] rounded-lg z-50 overflow-hidden;
    background-color: var(--color-surface-2);
    border: 1px solid var(--color-border-secondary);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
    top: calc(100% + 4px);
    max-height: 500px;
  }

  .model-selector-content {
    @apply p-2 overflow-y-auto;
    max-height: inherit;
  }

  .model-cards {
    @apply flex flex-col gap-1.5 mb-1.5;
  }

  .model-card-wrapper {
    @apply flex flex-col gap-0;
  }

  .model-card {
    @apply flex flex-col items-start gap-0.5 p-2.5 rounded-md bg-transparent text-left cursor-pointer transition-all;
    border: 1px solid transparent;
  }

  .model-card:hover {
    border-color: var(--color-border-hover);
    background-color: var(--color-surface-hover);
  }

  .model-card.selected {
    border-color: var(--color-brand-primary);
    background-color: var(--color-surface-active);
  }

  .model-card-header {
    @apply flex items-center justify-between w-full;
  }

  .model-card-icons {
    @apply flex items-center gap-1;
  }

  .model-card-name {
    @apply text-sm font-semibold;
    color: var(--color-text-primary);
  }

  .reasoning-expand-btn {
    @apply flex items-center justify-center w-6 h-6 p-0 border-none rounded-md bg-transparent cursor-pointer transition-all;
    color: var(--color-text-secondary);
  }

  .reasoning-expand-btn:hover {
    background-color: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  .reasoning-expand-btn svg {
    @apply w-3.5 h-3.5 transition-transform;
  }

  .model-card-check {
    @apply hidden;
  }

  .model-card-description {
    @apply text-xs leading-tight;
    color: var(--color-text-secondary);
  }

  .reasoning-panel {
    @apply mt-1.5 pt-1.5;
  }

  .reasoning-panel-content {
    @apply px-2.5 pb-1.5;
  }

  .reasoning-panel-label {
    @apply text-[10px] font-semibold mb-1.5 uppercase tracking-wider;
    color: var(--color-text-secondary);
  }

  .reasoning-options {
    @apply flex flex-col gap-1;
  }

  .reasoning-option {
    @apply flex flex-col items-start gap-0 p-1.5 rounded-md bg-transparent text-left cursor-pointer transition-all;
    border: 1px solid transparent;
  }

  .reasoning-option:hover {
    border-color: var(--color-border-hover);
    background-color: var(--color-surface-hover);
  }

  .reasoning-option.selected {
    border-color: var(--color-brand-primary);
    background-color: var(--color-surface-active);
  }

  .reasoning-option-header {
    @apply flex items-center justify-between w-full;
  }

  .reasoning-option-value {
    @apply text-xs font-semibold;
    color: var(--color-text-primary);
  }

  .reasoning-option-check {
    @apply hidden;
  }

  .reasoning-option-description {
    @apply text-[11px] leading-tight;
    color: var(--color-text-secondary);
  }

  .more-models-toggle {
    @apply flex items-center justify-between w-full py-2 px-2.5 border-none rounded-md bg-transparent text-xs font-medium cursor-pointer transition-colors;
    color: var(--color-text-secondary);
  }

  .more-models-toggle:hover {
    background-color: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  .more-models-toggle svg {
    @apply w-3.5 h-3.5 transition-transform;
  }

  .more-models-section {
    @apply flex flex-col gap-1 mt-1.5 pt-1.5;
  }

  /* Model family sub-dropdown group */
  .model-family-group {
    @apply flex flex-col;
  }

  .model-family-toggle {
    @apply flex items-center justify-between w-full py-2 px-2.5 border-none rounded-md bg-transparent text-xs font-medium cursor-pointer transition-colors;
    color: var(--color-text-secondary);
  }

  .model-family-toggle:hover {
    background-color: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  .model-family-toggle svg {
    @apply w-3.5 h-3.5 transition-transform;
  }

  .model-family-models {
    @apply flex flex-col gap-1 pl-3 mt-1 ml-2;
    border-left: 1px solid var(--color-border-secondary);
  }

  .reasoning-selector-section {
    @apply mt-3 pt-3;
  }

  .reasoning-label {
    @apply text-sm font-medium mb-2;
    color: var(--color-text-primary);
  }

  .reasoning-select {
    @apply w-full py-2 px-3 rounded-lg text-sm cursor-pointer transition-colors focus:outline-none;
    background-color: var(--color-surface-1);
    border: 1px solid var(--color-border-secondary);
    color: var(--color-text-primary);
  }

  .reasoning-select:hover {
    border-color: var(--color-border-hover);
  }

  .reasoning-select:focus {
    border-color: var(--color-border-focus);
    box-shadow: 0 0 0 1px var(--color-border-focus);
  }

  .welcome-send-btn {
    @apply col-start-3 row-start-1 justify-self-end;
  }

  .mcp-toggle-btn {
    @apply flex items-center justify-center w-9 h-9 p-0 rounded-[0.65rem] cursor-pointer flex-shrink-0;
    background-color: var(--color-surface-hover);
    border: 1px solid var(--color-border-secondary);
    color: var(--color-text-secondary);
    transition: color 0.2s, background-color 0.2s, border-color 0.2s, box-shadow 0.2s;
  }

  /* Off + hover: darken */
  .mcp-toggle-btn:not(.active):hover {
    background-color: var(--color-surface-1);
    color: var(--color-text-secondary);
  }

  .mcp-toggle-btn:active {
    transform: scale(0.95);
  }

  /* On: white icon + blue border + colored background */
  .mcp-toggle-btn.active {
    background-color: var(--color-surface-active);
    border-color: var(--color-border-hover);
    color: var(--color-text-primary);
  }

  /* On + hover: glow */
  .mcp-toggle-btn.active:hover {
    box-shadow: 0 0 12px 2px var(--color-brand-glow);
  }

  /* Toggle ON animation: ripple expands outward from icon */
  .mcp-toggle-btn.animate-on {
    animation: mcp-ripple-out 0.3s ease-out;
  }

  /* Toggle OFF animation: ripple contracts inward to icon */
  .mcp-toggle-btn.animate-off {
    animation: mcp-ripple-in 0.3s ease-out;
  }

  @keyframes mcp-ripple-out {
    0% {
      box-shadow: inset 0 0 0 18px var(--color-brand-glow);
    }
    100% {
      box-shadow: inset 0 0 0 0 var(--color-brand-glow);
    }
  }

  @keyframes mcp-ripple-in {
    0% {
      box-shadow: inset 0 0 0 0 var(--color-brand-glow);
    }
    50% {
      box-shadow: inset 0 0 0 18px var(--color-brand-glow);
    }
    100% {
      box-shadow: inset 0 0 0 0 transparent;
    }
  }

  .mcp-toggle-btn svg {
    @apply w-4 h-4;
  }

  .welcome-input {
    @apply w-full min-h-7 max-h-[200px] border-none outline-none bg-transparent text-base leading-[1.625] resize-none overflow-y-auto py-1 px-0;
    color: var(--color-text-primary);
  }

  .welcome-input::placeholder {
    color: var(--color-text-secondary);
    opacity: 0.6;
  }

  /* Compact variant - very small min height, tight text */
  .welcome-input-section.compact .welcome-input {
    @apply min-h-5 text-sm leading-[1.3] py-1.5;
    background-color: var(--color-surface-2);
    color: var(--color-text-user);
  }

  .welcome-send-btn {
    @apply flex items-center justify-center w-11 h-11 border-none rounded-full cursor-not-allowed transition-all;
    background-color: var(--color-surface-active);
    color: var(--color-text-user);
    opacity: 0.5;
  }

  /* Compact variant - very small button with equal spacing from edges */
  .welcome-input-section.compact .welcome-send-btn {
    @apply w-6 h-6 mr-1 mb-1;
  }

  .welcome-input-section.compact .welcome-send-btn svg {
    @apply w-3.5 h-3.5;
  }

  .welcome-send-btn.ready {
    @apply cursor-pointer;
    background-color: var(--color-brand-primary);
    color: var(--color-text-user);
    opacity: 1;
  }

  .welcome-send-btn.ready:hover {
    transform: translateY(-1px);
  }

  .welcome-send-btn.ready:active {
    transform: translateY(0);
  }

  .welcome-send-btn:disabled {
    @apply opacity-100;
  }

  /* ==========================================
   * PILL THEME SYSTEM
   * Single unified pill theme for all contexts
   * ========================================== */

  :root {
    --pill-bg: transparent;
    --pill-bg-hover: var(--color-surface-hover);
    --pill-border: var(--color-border-secondary);
    --pill-border-hover: var(--color-border-hover);
    --pill-text: var(--color-text-secondary);
    --pill-text-hover: var(--color-text-primary);
    --pill-backdrop: none;
    --pill-focus-ring: var(--color-brand-primary);
    --pill-focus-border: var(--color-border-focus);
    --pill-hover-transform: translateY(-1px);
  }

  /* ==========================================
   * PILL STYLES - Single source of truth
   * ========================================== */

  .suggestion-pills {
    @apply flex gap-2 flex-wrap justify-center mt-2;
  }

  .suggestion-pill {
    @apply flex items-center gap-1.5 py-2 px-3 rounded-lg text-sm font-[450] cursor-pointer transition-all whitespace-nowrap;
    background-color: var(--pill-bg);
    border: 1px solid var(--pill-border);
    color: var(--pill-text);
    backdrop-filter: var(--pill-backdrop);
    /* GPU acceleration for animations */
    will-change: transform, opacity;
    transform: translate3d(0, 0, 0);
    backface-visibility: hidden;
  }

  /* Pre-hide pills before animation runs to prevent flash during view transitions */
  .suggestion-pill.pills-pre-animate {
    opacity: 0;
    transform: translate3d(-30px, 0, 0);
  }

  .suggestion-pill:hover {
    background-color: var(--pill-bg-hover);
    color: var(--pill-text-hover);
    transform: var(--pill-hover-transform);
    /* Use custom property set by animation for vibrant color pop */
    border-color: var(--pill-color-vibrant, var(--pill-border-hover)) !important;
  }

  /* Individual pill hover colors - positional for flexibility */
  .suggestion-pill:nth-child(1):hover {
    border-color: var(--color-brand-accent-1) !important; /* Lime green */
  }

  .suggestion-pill:nth-child(2):hover {
    border-color: var(--color-brand-accent-2) !important; /* Light purple */
  }

  .suggestion-pill:nth-child(3):hover {
    border-color: var(--color-brand-accent-3) !important; /* Coral red */
  }

  .suggestion-pill:nth-child(4):hover {
    border-color: var(--color-brand-accent-4) !important; /* Cyan */
  }

  .suggestion-pill:nth-child(5):hover {
    border-color: var(--color-brand-accent-5) !important; /* Dark blue */
  }

  .suggestion-pill:active {
    color: var(--pill-text-hover);
    transform: translateY(0);
  }

  /* Focus indicator for accessibility (WCAG 2.4.7 AA) */
  .suggestion-pill:focus-visible {
    box-shadow: 0 0 0 3px var(--pill-focus-ring);
    outline: 2px solid transparent; /* High contrast mode fallback */
    opacity: 1 !important; /* Ensure pill is visible when focused during animation */
    border-color: var(--pill-focus-border);
  }

  .pill-icon {
    @apply w-4 h-4 flex items-center justify-center flex-shrink-0 transition-opacity;
    opacity: 0.7;
  }

  .suggestion-pill:hover .pill-icon {
    opacity: 0.95;
  }

  .pill-icon svg {
    @apply w-4 h-4;
  }

  .model-info {
    @apply mt-4 py-2 px-4 rounded-2xl text-sm font-medium;
    background-color: var(--color-surface-1);
    color: var(--color-text-secondary);
  }

  /* ==========================================
   * COLOR UTILITY CLASSES
   * Convenience classes for semantic tokens
   * ========================================== */

  /* Background utilities */
  .bg-surface-1 { background-color: var(--color-surface-1); }
  .bg-surface-2 { background-color: var(--color-surface-2); }
  .bg-surface-3 { background-color: var(--color-surface-3); }
  .bg-surface-overlay { background-color: var(--color-surface-overlay); }
  .bg-surface-hover { background-color: var(--color-surface-hover); }
  .bg-surface-active { background-color: var(--color-surface-active); }

  /* Text utilities */
  .text-primary { color: var(--color-text-primary); }
  .text-secondary { color: var(--color-text-secondary); }
  .text-assistant { color: var(--color-text-assistant); }
  .text-user { color: var(--color-text-user); }
  .text-on-surface { color: var(--color-text-on-surface); }

  /* Border utilities */
  .border-primary { border-color: var(--color-border-primary); }
  .border-secondary { border-color: var(--color-border-secondary); }
  .border-focus { border-color: var(--color-border-focus); }
  .border-hover { border-color: var(--color-border-hover); }

  /* Brand utilities */
  .bg-brand-primary { background-color: var(--color-brand-primary); }
  .bg-brand-secondary { background-color: var(--color-brand-secondary); }
  .text-brand-primary { color: var(--color-brand-primary); }
  .text-brand-secondary { color: var(--color-brand-secondary); }
  .border-brand-primary { border-color: var(--color-brand-primary); }
  .border-brand-secondary { border-color: var(--color-brand-secondary); }

  /* Status utilities */
  .text-info { color: var(--color-status-info); }
  .text-success { color: var(--color-status-success); }
  .text-warning { color: var(--color-status-warning); }
  .text-error { color: var(--color-status-error); }

  .bg-info { background-color: var(--color-status-info); }
  .bg-success { background-color: var(--color-status-success); }
  .bg-warning { background-color: var(--color-status-warning); }
  .bg-error { background-color: var(--color-status-error); }

  .welcome-files-section {
    @apply mt-8 w-full max-w-[600px];
  }

  .welcome-files-header {
    @apply flex items-center justify-between mb-3 px-1;
  }

  .welcome-files-title {
    @apply text-sm font-semibold;
    color: var(--color-text-secondary);
  }

  .welcome-files-refresh-btn {
    @apply bg-none border-none p-1 cursor-pointer rounded transition-all flex items-center justify-center;
    color: var(--color-text-secondary);
  }

  .welcome-files-refresh-btn:hover {
    background-color: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  .welcome-files-list {
    @apply rounded-lg p-2 max-h-[200px] overflow-y-auto min-h-[60px];
    background-color: var(--color-surface-overlay);
    border: 1px solid var(--color-border-secondary);
  }

  .welcome-files-list:empty::before {
    @apply block text-center text-sm p-4;
    color: var(--color-text-secondary);
    content: "No files uploaded yet";
  }

  .welcome-files-list .file-item {
    @apply py-2 px-3 mb-1 last:mb-0;
  }

  .welcome-files-list .files-loading,
  .welcome-files-list .files-error,
  .welcome-files-list .files-empty {
    @apply text-center p-4 text-sm;
    color: var(--color-text-secondary);
  }

  body.view-welcome .chat-panel,
  body.view-welcome .files-panel,
  body.view-welcome #files-toggle-wrapper,
  body.view-welcome #files-panel-toggle-wrapper {
    display: none !important;
  }

  body.view-chat .welcome-container {
    display: none !important;
  }

  /* User message bubble gradient - using existing CSS variable */
  .bg-user-gradient {
    background: var(--color-brand-gradient);
  }

  /* Toast notifications */
  .toast {
    @apply py-3.5 px-5 rounded-xl text-sm font-medium shadow-[0_4px_12px_rgba(0,0,0,0.15)] pointer-events-auto backdrop-blur-[10px] min-w-[200px] max-w-[400px];
    word-wrap: break-word;
  }

  .animate-fadeOut {
    animation: fadeOut 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  .animate-slideIn {
    animation: slideIn 0.3s ease-out;
  }

  .toast-pulse {
    animation: toast-pulse 0.2s ease-in-out;
  }

  /* ==========================================
   * MARKDOWN CONTENT STYLING
   * Too complex for inline utilities, keeps content readable
   * ========================================== */
  .message-content {
    max-width: 100%;
    font-size: 0.875rem;
    line-height: 1.5;
  }

  /* Optimize rendering performance for long message lists */
  .message {
    content-visibility: auto;
    contain-intrinsic-size: 0 100px; /* Estimated height to prevent scrollbar jumping */
  }

  .message-content h1,
  .message-content h2,
  .message-content h3,
  .message-content h4,
  .message-content h5,
  .message-content h6 {
    margin-top: 0.5em;
    margin-bottom: 0.2em;
    font-weight: 600;
    line-height: 1.25;
    color: var(--color-text-primary);
  }

  .message-content h1 {
    font-size: 1.5em;
  }
  .message-content h2 {
    font-size: 1.3em;
  }
  .message-content h3 {
    font-size: 1.15em;
  }
  .message-content h4 {
    font-size: 1.05em;
  }
  .message-content h5 {
    font-size: 1em;
  }
  .message-content h6 {
    font-size: 0.95em;
  }

  .message-content p {
    margin: 0.15em 0;
    line-height: 1.4;
  }

  .message-content p + p {
    margin-top: 0.5em;
  }

  /* Tighten gap between paragraph and code block - aggressive removal */
  .message-content p + pre:not(.mermaid),
  .message-content p + .code-block-wrapper,
  .message-content p + br + pre:not(.mermaid),
  .message-content p + br + .code-block-wrapper {
    margin-top: 0 !important;
  }

  /* Remove paragraph bottom margin before code */
  .message-content p:has(+ pre),
  .message-content p:has(+ .code-block-wrapper),
  .message-content p:has(+ br + pre),
  .message-content p:has(+ br + .code-block-wrapper) {
    margin-bottom: 0 !important;
  }

  /* Collapse empty paragraphs (often created by markdown blank lines) */
  .message-content p:empty {
    display: none;
  }

  /* DISABLED: This rule was hiding legitimate content like "Hey<br>World"
   * The :has(> br:only-child) selector should only match <p><br></p> but
   * may have browser quirks. Commenting out to fix rendering issues.
   */
  /* .message-content p:has(> br:only-child) {
    display: none;
  } */

  /* Hide standalone br tags between paragraph and code */
  .message-content p + br {
    display: none;
  }

  .message-content h1 + ul,
  .message-content h2 + ul,
  .message-content h3 + ul,
  .message-content h4 + ul,
  .message-content h5 + ul,
  .message-content h6 + ul,
  .message-content h1 + ol,
  .message-content h2 + ol,
  .message-content h3 + ol,
  .message-content h4 + ol,
  .message-content h5 + ol,
  .message-content h6 + ol {
    margin-top: 0.1em;
  }

  .message-content > *:first-child {
    margin-top: 0;
  }

  .message-content > *:last-child {
    margin-bottom: 0;
  }

  /* Code styling */
  .message-content code {
    background-color: var(--color-surface-overlay);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.9em;
    font-family: monospace;
    color: var(--color-text-primary);
  }

  .message-content pre:not(.mermaid) {
    background-color: var(--color-surface-overlay);
    border: 1px solid var(--color-border-secondary);
    border-radius: 0.5rem;
    padding: 0.625rem;
    overflow-x: auto;
    margin: 0.2em 0;
  }

  .message-content pre code {
    background-color: transparent;
    padding: 0;
    border-radius: 0;
    font-size: 0.85em;
    line-height: 1.5;
  }

  /* Code block with copy button */
  .message-content .code-block-wrapper {
    margin: 0.2em 0;
    display: block;
  }

  /* Override wrapper margin when following paragraph - handled above with !important */

  .message-content .code-block-wrapper pre {
    margin: 0;
    display: block;
    position: relative;
  }

  .message-content .code-block-wrapper .code-copy-btn {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: var(--color-surface-overlay);
    border: 1px solid var(--color-border-secondary);
    color: var(--color-text-primary);
    cursor: pointer;
    padding: 0.375rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.375rem;
    transition: all 0.15s ease;
    opacity: 0;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  .message-content .code-block-wrapper:hover .code-copy-btn {
    opacity: 1;
  }

  .message-content .code-copy-btn:hover {
    background-color: var(--color-surface-hover);
    color: var(--color-text-primary);
    transform: scale(1.05);
  }

  .message-content .code-copy-btn.copied {
    color: var(--color-status-success);
    opacity: 1;
  }

  .message-content .code-copy-btn svg {
    width: 16px;
    height: 16px;
    stroke-width: 2;
  }

  /* Lists */
  .message-content ul {
    margin: 0.15em 0;
    padding-left: 1.5rem;
    line-height: 1.35;
    list-style-type: disc;
    list-style-position: outside;
  }

  .message-content ol {
    margin: 0.15em 0;
    padding-left: 1.5rem;
    line-height: 1.35;
    list-style-type: decimal;
    list-style-position: outside;
  }

  .message-content ul ul {
    list-style-type: circle;
    margin: 0 0 0.02em 0;
  }

  .message-content ul ul ul {
    list-style-type: square;
    margin: 0 0 0.02em 0;
  }

  .message-content ol ol {
    list-style-type: lower-alpha;
    margin: 0 0 0.02em 0;
  }

  .message-content ol ol ol {
    list-style-type: lower-roman;
    margin: 0 0 0.02em 0;
  }

  .message-content ol ul,
  .message-content ul ol {
    margin: 0 0 0.02em 0;
  }

  .message-content li {
    margin: 0.02em 0;
    padding-left: 0.2em;
    display: list-item;
  }

  .message-content li li {
    margin: 0.01em 0;
  }

  .message-content li > ul,
  .message-content li > ol {
    margin: 0 0 0.02em 0;
    margin-top: 0;
  }

  /* Blockquotes */
  .message-content blockquote {
    border-left: 3px solid var(--color-border-primary);
    margin: 0.4em 0;
    padding: 0.4em 0.8em;
    background-color: var(--color-surface-overlay);
    font-style: italic;
    color: var(--color-text-secondary);
  }

  /* Links */
  .message-content a {
    color: var(--color-brand-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 150ms;
  }

  .message-content a:hover {
    border-bottom-color: var(--color-brand-primary);
  }

  /* Tables */
  .message-content table {
    border-collapse: collapse;
    width: 100%;
    margin: 0.4em 0;
    font-size: 0.9em;
  }

  .message-content th,
  .message-content td {
    border: 1px solid var(--color-border-secondary);
    padding: 0.5rem 0.75rem;
    text-align: left;
  }

  .message-content th {
    background-color: var(--color-surface-overlay);
    font-weight: 600;
  }

  /* Images */
  .message-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    margin: 0.5em 0;
    box-shadow: 0 1px 3px var(--color-surface-overlay);
  }

  /* Horizontal rule */
  .message-content hr {
    border: 0;
    border-top: 1px solid var(--color-border-secondary);
    margin: 0.4em 0;
  }

  /* Strong/bold text */
  .message-content strong {
    font-weight: 600;
    color: var(--color-text-primary);
  }

  /* Task lists (checkboxes) */
  .message-content input[type="checkbox"] {
    margin-right: 0.5em;
    vertical-align: middle;
    cursor: default;
  }

  .message-content li:has(> input[type="checkbox"]) {
    list-style-type: none;
    margin-left: -1.5rem;
  }

  /* Mermaid diagrams */
  .message-content .mermaid-wrapper {
    margin: 0.5rem 0;
    padding: 1rem;
    background-color: var(--color-surface-1);
    border: 1px solid var(--color-border-secondary);
    border-radius: 0.5rem;
    overflow-x: auto;
    min-height: 100px;
    overflow-anchor: none; /* Prevent expanding diagrams from being scroll anchor */
  }

  .message-content .mermaid-wrapper svg {
    display: block;
    max-width: 100%;
    height: auto;
  }

  /* Mermaid loading placeholder - progressive rendering */
  .mermaid-wrapper.mermaid-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-surface-overlay);
    border: 1px dashed var(--color-border-secondary);
  }

  .mermaid-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    color: var(--color-text-secondary);
    font-size: 0.875rem;
  }

  .mermaid-spinner {
    width: 24px;
    height: 24px;
    border: 2px solid var(--color-border-secondary);
    border-top-color: var(--color-brand-primary);
    border-radius: 50%;
    animation: mermaid-spin 1s linear infinite;
  }

  @keyframes mermaid-spin {
    to { transform: rotate(360deg); }
  }

  /* Spacing adjustments for different content combinations */
  .message-content p + ul,
  .message-content p + ol {
    margin-top: 0.25em;
  }

  .message-content ul + p,
  .message-content ol + p {
    margin-top: 0.25em;
  }

  /* ===========================================
   * PROSE OVERRIDES - Typography plugin has aggressive defaults
   * These must be more specific than .prose selectors
   * =========================================== */

  /* Override prose pre margins */
  .prose pre,
  .message-content.prose pre,
  .message-content pre {
    margin-top: 0.5em !important;
    margin-bottom: 1.5em !important;
  }

  /* Override prose code-block-wrapper margins */
  .prose .code-block-wrapper,
  .message-content.prose .code-block-wrapper,
  .message-content .code-block-wrapper {
    margin-top: 0.5em !important;
    margin-bottom: 1.5em !important;
  }

  /* Code blocks inside list items - tighter spacing than standalone */
  .prose li pre,
  .prose li .code-block-wrapper,
  .message-content.prose li pre,
  .message-content.prose li .code-block-wrapper,
  .message-content li pre,
  .message-content li .code-block-wrapper {
    margin-top: 0.15em !important;
    margin-bottom: 0.15em !important;
  }

  /* Reduce prose li margins when containing code */
  .prose li:has(pre),
  .prose li:has(.code-block-wrapper),
  .message-content li:has(pre),
  .message-content li:has(.code-block-wrapper) {
    margin-top: 0.25em !important;
    margin-bottom: 0.25em !important;
  }

  /* DISABLED: This was hiding intentional line breaks in list items
   * e.g., "- Line one  \n  Line two" produces <li>Line one<br>Line two</li>
   * and the br was being hidden, merging the lines together.
   */
  /* .message-content li > br,
  .prose li > br {
    display: none;
  } */

  .message-content p + pre {
    margin-top: 0.15em;
  }

  .message-content pre + p {
    margin-top: 0.15em;
  }

  .message-content h1 + pre,
  .message-content h2 + pre,
  .message-content h3 + pre,
  .message-content h4 + pre,
  .message-content h5 + pre,
  .message-content h6 + pre {
    margin-top: 0.2em;
  }
}

/* Background colors for welcome vs chat view - Outside layers for higher specificity */
body.view-welcome {
  background: var(--color-body-welcome) !important;
}

body.view-chat {
  background: var(--color-body-chat) !important;
}

/* ===========================================
 * PROSE TYPOGRAPHY OVERRIDES - Outside layers for maximum specificity
 * Tailwind Typography plugin has aggressive defaults that override layered CSS
 * =========================================== */

/* Fix: Remove padding from code-block-wrapper and margin from inner pre */
.prose .code-block-wrapper,
.message-content .code-block-wrapper {
  padding: 0 !important;
  margin: 0.5em 0 1.5em 0 !important; /* balanced spacing: half-line above, line-and-half below */
}

.prose .code-block-wrapper pre,
.message-content .code-block-wrapper pre {
  margin: 0 !important;
}

/* Tighter margins on paragraphs */
.prose p,
.message-content p {
  margin: 0.15em 0 !important;
}

/* Override prose pre margins (code-block-wrapper handled above) */
.prose pre:not(.code-block-wrapper pre) {
  margin-top: 0.5em !important;
  margin-bottom: 1.5em !important;
}

/* Code blocks inside list items */
.prose li pre,
.prose li .code-block-wrapper {
  margin-top: 0.15em !important;
  margin-bottom: 0.15em !important;
}

/* Reduce li margins when containing code */
.prose li:has(pre),
.prose li:has(.code-block-wrapper) {
  margin-top: 0.2em !important;
  margin-bottom: 0.2em !important;
}

/* DISABLED: Same issue as above - hides intentional line breaks in list items */
/* .prose li > br {
  display: none;
} */

/* Override prose paragraph margins before code */
.prose p + pre,
.prose p + .code-block-wrapper {
  margin-top: 0.15em !important;
}

/* Mermaid diagrams - match code block spacing */
.prose .mermaid-wrapper,
.message-content .mermaid-wrapper {
  margin-top: 0.5em !important;
  margin-bottom: 1.5em !important;
}

/* Base styles */
@layer base {
  /* ==========================================
   * KEYFRAME ANIMATIONS
   * ========================================== */
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeOut {
    0% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translateY(-8px) scale(0.95);
    }
  }

  @keyframes toast-pulse {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }

  @keyframes streaming-pulse {
    0%,
    100% {
      opacity: 1;
      transform: translateY(-50%) scale(1);
    }
    50% {
      opacity: 0.5;
      transform: translateY(-50%) scale(0.8);
    }
  }

  :root {
    /* ========================================
     * SURFACE COLORS
     * ======================================== */
    --color-surface-1: #141622;
    --color-surface-2: #191b29;
    --color-surface-3: #1e2432;
    --color-surface-overlay: rgba(255, 255, 255, 0.05);
    --color-surface-hover: rgba(255, 255, 255, 0.03);
    --color-surface-active: rgba(37, 99, 235, 0.12);

    /* Body background colors */
    --color-body-welcome: #191b29;  /* Surface-2 for welcome page */
    --color-body-chat: #191b29;     /* Surface-2 for chat view */

    /* Welcome page specific colors */
    --color-welcome-text: #f5f5f5;      /* Use existing text-primary */
    --color-welcome-secondary: #a0a0a0; /* Use existing text-secondary */

    /* Welcome pill colors (uses standard semantic tokens) */
    --color-welcome-pill-bg: transparent;
    --color-welcome-pill-bg-hover: var(--color-surface-hover);
    --color-welcome-pill-border: var(--color-border-secondary);
    --color-welcome-pill-border-hover: var(--color-border-hover);
    --color-welcome-pill-text: var(--color-text-secondary);
    --color-welcome-pill-text-hover: var(--color-text-primary);
    --color-welcome-pill-focus-ring: var(--color-brand-primary);

    /* ========================================
     * TEXT COLORS
     * ======================================== */
    --color-text-primary: #f5f5f5;
    --color-text-secondary: #a0a0a0;
    --color-text-assistant: #f1f5f9;
    --color-text-user: #ffffff;
    --color-text-on-surface: #d1d5db;

    /* ========================================
     * BORDER COLORS (WCAG AA compliant)
     * ======================================== */
    --color-border-primary: #3b4254;    /* Unified, subtle border tone */
    --color-border-secondary: #3b4254;  /* Unified, subtle border tone */
    --color-border-focus: #0d63fb;      /* Brand blue for consistency */
    --color-border-hover: #0d63fb;

    /* ========================================
     * BRAND COLORS
     * ======================================== */
    --color-brand-primary: #0d63fb;
    --color-brand-secondary: #0a4fc9;  /* Darker shade for gradients */
    --color-brand-gradient: linear-gradient(135deg, #0d63fb 0%, #0a4fc9 100%);
    --color-brand-glow: rgba(13, 99, 251, 0.2);  /* Brand blue at 20% for focus/hover glows */

    /* Secondary brand colors for accents */
    --color-brand-accent-1: #deff4d;  /* Lime green */
    --color-brand-accent-2: #c7baff;  /* Light purple */
    --color-brand-accent-3: #ff4d5f;  /* Coral red */
    --color-brand-accent-4: #1de1f2;  /* Cyan */
    --color-brand-accent-5: #012faf;  /* Dark blue */

    /* ========================================
     * STATUS COLORS
     * ======================================== */
    --color-status-info: #3b82f6;
    --color-status-success: #10b981;
    --color-status-warning: #f59e0b;
    --color-status-error: #ef4444;

    /* ========================================
     * FUNCTION CALL STATES
     * ======================================== */
    --color-function-executing: linear-gradient(135deg, #0d63fb 0%, #0a4fc9 100%);
    --color-function-success: linear-gradient(135deg, #059669 0%, #10b981 100%);
    --color-function-error: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);

    /* ========================================
     * SCROLLBAR COLORS
     * ======================================== */
    --color-scrollbar-thumb: #333333;
    --color-scrollbar-thumb-hover: #a0a0a0;

    /* ========================================
     * OVERLAYS
     * ======================================== */
    --color-overlay-backdrop: rgba(0, 0, 0, 0.9);

    /* ========================================
     * FILE TYPE COLORS (slightly lighter for contrast)
     * ======================================== */
    --color-file-image: #c084fc;   /* Light purple */
    --color-file-code: #fbbf24;    /* Light yellow */
    --color-file-archive: #a16207; /* Light brown */
    --color-file-audio: #f472b6;   /* Light pink */
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow: hidden;
    transition: all 300ms;
  }

  /* Placeholder text for empty states */
  .files-loading,
  .files-empty,
  .sessions-loading {
    @apply p-4 text-center text-sm text-gray-600;
  }

  .files-empty svg {
    @apply inline-block;
  }

  .files-error {
    @apply p-4 text-center text-sm text-red-400;
  }

  /* ==========================================
   * ACCESSIBILITY: Forced colors mode (high contrast)
   * Disable animations and ensure proper contrast
   * ========================================== */
  @media (forced-colors: active) {
    .welcome-greeting,
    .suggestion-pill {
      animation: none !important;
      transition: none !important;
      opacity: 1 !important;
      transform: none !important;
    }
  }
}
