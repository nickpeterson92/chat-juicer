@import "tailwindcss";

@variant dark (&:where([data-theme="dark"], [data-theme="dark"] *));

/* Tailwind v4 Theme - Simplified to essentials only */
@theme {
  /* Custom brand color */
  --color-brand-bg: #f8f8f6;
  --color-dark-bg: #1e2432;

  /* Keyframe animations that Tailwind doesn't provide */
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes typing {
    0%, 60%, 100% {
      opacity: 0.3;
    }
    30% {
      opacity: 1;
    }
  }

  @keyframes fadeOut {
    0% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translateY(-8px) scale(0.95);
    }
  }

  @keyframes toast-pulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }
}

/* Essential custom CSS - Platform-specific features and complex patterns */
@layer components {
  /* ==========================================
   * PLATFORM-SPECIFIC: macOS window dragging
   * ========================================== */
  .macos-drag-handle {
    -webkit-app-region: drag;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 32px;
    z-index: 10000;
    background: transparent;
    pointer-events: auto;
  }

  body:has(.custom-titlebar) .macos-drag-handle {
    display: none;
  }

  #sidebar-toggle,
  #open-files-btn {
    -webkit-app-region: no-drag;
    position: relative;
    z-index: 10001;
  }

  /* ==========================================
   * PLATFORM-SPECIFIC: Custom titlebar (Windows/Linux)
   * ========================================== */
  .custom-titlebar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 32px;
    background: #ffffff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    user-select: none;
    z-index: 10000;
    border-bottom: 1px solid #e5e7eb;
    transition: background-color 0.2s, border-color 0.2s;
  }

  .dark .custom-titlebar {
    background: #1f2937;
    border-bottom-color: #374151;
  }

  .titlebar-drag-region {
    -webkit-app-region: drag;
    flex: 1;
    height: 100%;
    display: flex;
    align-items: center;
    padding-left: 12px;
  }

  .titlebar-title {
    font-size: 13px;
    font-weight: 500;
    color: #374151;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .dark .titlebar-title {
    color: #d1d5db;
  }

  .titlebar-controls {
    -webkit-app-region: no-drag;
    display: flex;
    height: 100%;
  }

  .titlebar-button {
    width: 46px;
    height: 100%;
    border: none;
    background: transparent;
    color: #6b7280;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.15s, color 0.15s;
    padding: 0;
    margin: 0;
  }

  .dark .titlebar-button {
    color: #9ca3af;
  }

  .titlebar-button:hover {
    background: #f3f4f6;
    color: #1f2937;
  }

  .dark .titlebar-button:hover {
    background: #374151;
    color: #f9fafb;
  }

  .titlebar-close:hover {
    background: #dc2626;
    color: #ffffff;
  }

  .dark .titlebar-close:hover {
    background: #dc2626;
    color: #ffffff;
  }

  .titlebar-button svg {
    width: 10px;
    height: 10px;
  }

  body:has(.custom-titlebar) {
    padding-top: 32px;
  }

  /* ==========================================
   * CUSTOM SCROLLBARS (not available in Tailwind)
   * ========================================== */
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #e5e7eb;
    border-radius: 0.25rem;
  }

  [data-theme="dark"] .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #333333;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #6b7280;
  }

  [data-theme="dark"] .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #a0a0a0;
  }

  .sessions-scrollbar::-webkit-scrollbar {
    width: 6px;
  }

  .sessions-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .sessions-scrollbar::-webkit-scrollbar-thumb {
    background-color: #e5e7eb;
    border-radius: 0.125rem;
  }

  [data-theme="dark"] .sessions-scrollbar::-webkit-scrollbar-thumb {
    background-color: #333333;
  }

  .sessions-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #6b7280;
  }

  [data-theme="dark"] .sessions-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #a0a0a0;
  }

  /* ==========================================
   * DYNAMICALLY CREATED COMPONENTS
   * Minimal classes for JavaScript-generated elements
   * ========================================== */

  /* Session items in sidebar */
  .session-item {
    @apply p-3 mb-1 rounded-lg cursor-pointer text-sm transition-colors flex items-center justify-between gap-2 text-gray-800 hover:bg-gray-100;
  }

  [data-theme="dark"] .session-item {
    @apply text-gray-100 hover:bg-gray-800;
  }

  .session-item.active {
    @apply bg-blue-600 text-white;
  }

  .session-title {
    @apply flex-1 overflow-hidden text-ellipsis whitespace-nowrap;
  }

  .session-actions {
    @apply flex gap-1 opacity-0 transition-opacity;
  }

  .session-item:hover .session-actions {
    @apply opacity-100;
  }

  .session-action-btn {
    @apply bg-transparent border-none cursor-pointer p-1 rounded transition-colors;
  }

  .session-action-btn:hover {
    @apply bg-black/10;
  }

  .session-item.active .session-action-btn:hover {
    @apply bg-white/20;
  }

  .session-title-edit {
    font-family: inherit;
  }

  [data-theme="dark"] .session-title-edit {
    @apply bg-[#1e2432] text-gray-100 border-blue-600;
  }

  .load-more-sessions-btn {
    @apply w-full py-2.5 px-3 mt-2 bg-transparent border border-gray-200 rounded-lg text-gray-800 text-[13px] font-medium cursor-pointer transition-all text-center hover:bg-gray-100 hover:border-blue-600 hover:text-blue-600 disabled:opacity-50 disabled:cursor-not-allowed;
  }

  [data-theme="dark"] .load-more-sessions-btn {
    @apply border-gray-700 text-gray-100 hover:bg-gray-800;
  }

  /* Function call cards */
  .function-call-card {
    @apply block bg-black/[0.04] border border-black/10 rounded-md px-2.5 py-1.5 my-1 text-xs cursor-pointer transition-all hover:bg-black/[0.06] hover:border-black/15;
    animation: slideIn 0.3s ease-out;
  }

  [data-theme="dark"] .function-call-card {
    @apply bg-white/[0.06] border-white/10 hover:bg-white/[0.08] hover:border-white/15;
  }

  .function-call-card.expanded {
    @apply block cursor-default bg-[#f8f8f6] border-gray-200 p-3.5 px-4 my-1.5 rounded-lg max-w-full;
  }

  [data-theme="dark"] .function-call-card.expanded {
    @apply bg-[#1e2432] border-gray-700;
  }

  .function-call-card.expanded:hover {
    @apply bg-[#f8f8f6] border-gray-200 transform-none;
  }

  [data-theme="dark"] .function-call-card.expanded:hover {
    @apply bg-[#1e2432] border-gray-700;
  }

  .function-call-card.executing {
    @apply text-white border-indigo-400/40;
    background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
  }

  .function-call-card.success {
    @apply text-white border-emerald-500/40;
    background: linear-gradient(135deg, #059669 0%, #10b981 100%);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .function-call-card.error {
    @apply text-white border-red-500/40;
    background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
  }

  .function-header {
    @apply flex items-center gap-2 mb-0;
  }

  .function-call-card.expanded .function-header {
    @apply gap-2 mb-2.5;
  }

  .function-icon {
    @apply w-3.5 h-3.5 inline-flex items-center justify-center flex-shrink-0 opacity-70;
  }

  .function-icon svg {
    @apply w-3.5 h-3.5;
  }

  .function-call-card.expanded .function-icon {
    @apply w-[18px] h-[18px] bg-black/[0.08] rounded opacity-100 text-[11px];
  }

  .function-call-card.expanded .function-icon svg {
    @apply w-3.5 h-3.5;
  }

  [data-theme="dark"] .function-call-card.expanded .function-icon {
    @apply bg-white/15;
  }

  .function-name {
    @apply font-semibold text-xs whitespace-nowrap flex-shrink-0 font-mono;
  }

  .function-call-card.expanded .function-name {
    @apply text-xs font-semibold tracking-wider flex-1 whitespace-nowrap overflow-hidden text-ellipsis font-sans;
  }

  .function-params {
    @apply font-normal text-xs opacity-70 whitespace-nowrap overflow-hidden text-ellipsis flex-shrink min-w-0 font-mono;
  }

  .function-call-card.expanded .function-params {
    @apply hidden;
  }

  .function-status {
    @apply hidden;
  }

  .function-call-card.expanded .function-status {
    @apply inline-block text-[10px] opacity-90 font-medium lowercase bg-black/[0.08] py-0.5 px-1.5 rounded-md flex-shrink-0;
  }

  [data-theme="dark"] .function-call-card.expanded .function-status {
    @apply bg-black/15;
  }

  .function-expand-indicator {
    @apply hidden;
  }

  .function-arguments {
    @apply hidden;
  }

  .function-call-card.expanded .function-arguments {
    @apply block bg-black/15 border border-white/15 rounded-md p-1.5 px-2 mt-1.5 font-mono text-xs max-h-[120px] overflow-y-auto break-all text-white/95 leading-relaxed backdrop-blur-[10px];
  }

  [data-theme="dark"] .function-call-card.expanded .function-arguments {
    @apply bg-[#1e2432] border-gray-700 text-gray-400 backdrop-blur-none;
  }

  .function-result {
    @apply hidden;
  }

  .function-call-card.expanded .function-result {
    @apply block bg-black/15 border border-white/15 rounded-lg p-2.5 px-3 mt-2.5 text-xs max-h-[150px] overflow-y-auto overflow-x-hidden break-words whitespace-pre-wrap text-white/95 leading-relaxed font-medium backdrop-blur-[10px];
  }

  [data-theme="dark"] .function-call-card.expanded .function-result {
    @apply bg-[#1e2432] border-gray-700 text-gray-400 backdrop-blur-none;
  }

  /* File items */
  .file-item {
    @apply flex items-center gap-2.5 py-2.5 px-3 bg-[#f8f8f6] border border-gray-200 rounded-lg transition-all cursor-pointer select-none hover:border-blue-600 hover:shadow-[0_0_0_3px_rgba(0,102,204,0.2)] active:scale-[0.98];
  }

  [data-theme="dark"] .file-item {
    @apply bg-[#1e2432] border-gray-700;
  }

  [data-theme="dark"] .file-item:hover {
    @apply border-blue-600 shadow-[0_0_0_3px_rgba(0,102,204,0.2)];
  }

  .file-icon {
    @apply text-lg flex-shrink-0 text-gray-500 flex items-center justify-center;
  }

  [data-theme="dark"] .file-icon {
    @apply text-gray-400;
  }

  .file-name {
    @apply flex-1 text-[13px] text-gray-800 overflow-hidden text-ellipsis whitespace-nowrap font-medium;
  }

  [data-theme="dark"] .file-name {
    @apply text-gray-100;
  }

  .file-size {
    @apply text-[11px] text-gray-500 flex-shrink-0;
  }

  [data-theme="dark"] .file-size {
    @apply text-gray-400;
  }

  .file-delete-btn {
    @apply bg-transparent border-none cursor-pointer p-1 rounded text-sm text-gray-500 transition-all opacity-0 flex-shrink-0 hover:bg-red-500/10 hover:text-red-500 hover:scale-110;
  }

  [data-theme="dark"] .file-delete-btn {
    @apply text-gray-400;
  }

  .file-item:hover .file-delete-btn {
    @apply opacity-100;
  }

  /* Welcome page components */
  .welcome-container {
    @apply absolute inset-0 flex items-center justify-center z-[100];
  }

  .welcome-content {
    @apply max-w-[720px] w-full px-8 pt-8 pb-12 flex flex-col items-center gap-8 translate-y-[4vh];
  }

  .welcome-header {
    @apply flex flex-col items-center gap-4 relative;
  }

  .welcome-logo {
    @apply absolute -left-[5.5rem] top-1/2 -translate-y-1/2 w-16 h-16 rounded-2xl text-gray-800;
  }

  [data-theme="dark"] .welcome-logo {
    @apply text-gray-100;
  }

  .welcome-greeting {
    @apply text-3xl font-medium text-gray-800 m-0;
  }

  [data-theme="dark"] .welcome-greeting {
    @apply text-gray-100;
  }

  .welcome-input-section {
    @apply w-full flex flex-col gap-3 bg-[#f8f8f6] border border-gray-200 rounded-3xl py-5 px-6 transition-all focus-within:border-blue-600 focus-within:shadow-[0_0_0_3px_rgba(0,102,204,0.2)];
  }

  [data-theme="dark"] .welcome-input-section {
    @apply bg-[#1e2432] border-gray-700;
  }

  .welcome-input-footer {
    @apply grid grid-cols-[auto_1fr_auto] grid-rows-[auto_auto] items-center gap-1.5 pt-2;
  }

  .mcp-toggle-buttons {
    @apply flex items-center gap-1.5 flex-shrink-0 col-start-1 row-start-1 row-end-3 self-center;
  }

  .model-config-inline {
    @apply flex flex-col items-end gap-1 flex-shrink-0 col-start-3 row-start-1;
  }

  .welcome-send-btn {
    @apply col-start-3 row-start-2 justify-self-end;
  }

  .inline-select {
    @apply appearance-none bg-transparent border-none py-1 pr-6 pl-2 text-sm font-medium text-gray-500 cursor-pointer transition-colors min-w-[120px] text-right hover:text-gray-800 focus:outline-none focus:text-blue-600;
    background-image: url('data:image/svg+xml,%3Csvg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M4 6L8 10L12 6" stroke="%23666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/%3E%3C/svg%3E');
    background-repeat: no-repeat;
    background-position: right 0.25rem center;
    background-size: 16px 16px;
  }

  [data-theme="dark"] .inline-select {
    @apply text-gray-400 hover:text-gray-100;
    background-image: url('data:image/svg+xml,%3Csvg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M4 6L8 10L12 6" stroke="%23999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/%3E%3C/svg%3E');
  }

  .mcp-toggle-btn {
    @apply flex items-center justify-center w-9 h-9 p-0 border border-black/10 rounded-[0.65rem] bg-[#0f1729]/[0.03] text-gray-600/65 cursor-pointer transition-all flex-shrink-0 hover:border-black/[0.18] hover:bg-[#0f1729]/[0.07] hover:text-gray-600/[0.82];
    box-shadow: inset 0 0 0 0 rgba(59, 130, 246, 0);
  }

  [data-theme="dark"] .mcp-toggle-btn {
    @apply border-white/10 bg-white/[0.03] text-gray-300/70 hover:border-white/20 hover:bg-white/[0.07] hover:text-gray-300/85;
  }

  .mcp-toggle-btn.active {
    @apply border-blue-600/65 bg-blue-600/12 text-blue-600;
    box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.2);
  }

  [data-theme="dark"] .mcp-toggle-btn.active {
    @apply border-blue-500/70 bg-blue-600/[0.18] text-blue-400;
    box-shadow: inset 0 0 0 1px rgba(96, 165, 250, 0.35);
  }

  .mcp-toggle-btn svg {
    @apply w-4 h-4;
  }

  .welcome-input {
    @apply w-full min-h-7 max-h-[200px] border-none outline-none bg-transparent text-gray-800 text-base leading-[1.625] resize-none overflow-y-auto p-0 placeholder:text-gray-500/60;
  }

  [data-theme="dark"] .welcome-input {
    @apply text-gray-100 placeholder:text-gray-300/60;
  }

  .welcome-send-btn {
    @apply flex items-center justify-center w-11 h-11 border-none rounded-full bg-blue-600/[0.18] text-white/75 cursor-not-allowed transition-all;
    box-shadow: inset 0 0 0 0 rgba(59, 130, 246, 0.4);
  }

  [data-theme="dark"] .welcome-send-btn {
    @apply bg-blue-600/20 text-blue-50/80;
  }

  .welcome-send-btn.ready {
    @apply cursor-pointer bg-blue-600 text-white shadow-[0_10px_20px_-12px_rgba(37,99,235,0.7)] hover:shadow-[0_12px_26px_-16px_rgba(37,99,235,0.9)] hover:-translate-y-px active:translate-y-0 active:shadow-[0_6px_18px_-12px_rgba(37,99,235,0.75)];
  }

  [data-theme="dark"] .welcome-send-btn.ready {
    @apply bg-blue-600 text-white shadow-[0_10px_24px_-14px_rgba(96,165,250,0.8)] hover:shadow-[0_12px_28px_-18px_rgba(96,165,250,0.9)] active:shadow-[0_8px_20px_-14px_rgba(59,130,246,0.85)];
  }

  .welcome-send-btn:disabled {
    @apply opacity-100;
  }

  .suggestion-pills {
    @apply flex gap-2 flex-wrap justify-center mt-2;
  }

  .suggestion-pill {
    @apply flex items-center gap-1.5 py-2 px-3 border border-black/10 rounded-lg bg-transparent text-gray-600/75 text-sm font-[450] cursor-pointer transition-all whitespace-nowrap hover:border-black/20 hover:bg-black/[0.03] hover:text-gray-600/95 active:text-gray-600;
  }

  [data-theme="dark"] .suggestion-pill {
    @apply border-white/[0.12] text-gray-300/70 hover:border-white/25 hover:bg-white/[0.04] hover:text-gray-300/95 active:text-gray-300;
  }

  .pill-icon {
    @apply w-4 h-4 flex items-center justify-center flex-shrink-0 opacity-50 transition-opacity;
  }

  .suggestion-pill:hover .pill-icon {
    @apply opacity-80;
  }

  .pill-icon svg {
    @apply w-4 h-4;
  }

  .model-info {
    @apply mt-4 py-2 px-4 rounded-2xl bg-[#f8f8f6] text-gray-500 text-sm font-medium;
  }

  [data-theme="dark"] .model-info {
    @apply bg-[#1e2432] text-gray-400;
  }

  .welcome-files-section {
    @apply mt-8 w-full max-w-[600px];
  }

  .welcome-files-header {
    @apply flex items-center justify-between mb-3 px-1;
  }

  .welcome-files-title {
    @apply text-sm font-semibold text-gray-500;
  }

  [data-theme="dark"] .welcome-files-title {
    @apply text-white/70;
  }

  .welcome-files-refresh-btn {
    @apply bg-none border-none p-1 cursor-pointer text-gray-500 rounded transition-all flex items-center justify-center hover:bg-black/[0.05] hover:text-gray-800;
  }

  [data-theme="dark"] .welcome-files-refresh-btn {
    @apply text-white/70 hover:bg-white/10 hover:text-gray-100;
  }

  .welcome-files-list {
    @apply bg-black/[0.02] border border-gray-200 rounded-lg p-2 max-h-[200px] overflow-y-auto min-h-[60px];
  }

  [data-theme="dark"] .welcome-files-list {
    @apply bg-white/[0.05] border-gray-700;
  }

  .welcome-files-list:empty::before {
    @apply block text-center text-gray-500 text-sm p-4;
    content: "No files uploaded yet";
  }

  [data-theme="dark"] .welcome-files-list:empty::before {
    @apply text-gray-400;
  }

  .welcome-files-list .file-item {
    @apply py-2 px-3 mb-1 last:mb-0;
  }

  .welcome-files-list .files-loading,
  .welcome-files-list .files-error,
  .welcome-files-list .files-empty {
    @apply text-center p-4 text-sm text-gray-500;
  }

  [data-theme="dark"] .welcome-files-list .files-loading,
  [data-theme="dark"] .welcome-files-list .files-error,
  [data-theme="dark"] .welcome-files-list .files-empty {
    @apply text-gray-400;
  }

  .view-welcome .chat-panel,
  .view-welcome .files-panel,
  .view-welcome #files-toggle-wrapper,
  .view-welcome #files-panel-toggle-wrapper {
    display: none !important;
  }

  .view-chat .welcome-container {
    display: none !important;
  }

  /* User message bubble gradient - using Tailwind best practices */
  .bg-user-gradient {
    @apply bg-gradient-to-br from-[#0066cc] to-[#0052a3];
  }

  /* Toast notifications */
  .toast {
    @apply py-3.5 px-5 rounded-xl text-sm font-medium shadow-[0_4px_12px_rgba(0,0,0,0.15)] pointer-events-auto backdrop-blur-[10px] min-w-[200px] max-w-[400px];
    word-wrap: break-word;
  }

  .animate-fadeOut {
    animation: fadeOut 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  .animate-slideIn {
    animation: slideIn 0.3s ease-out;
  }

  .toast-pulse {
    animation: toast-pulse 0.2s ease-in-out;
  }

  /* ==========================================
   * MARKDOWN CONTENT STYLING
   * Too complex for inline utilities, keeps content readable
   * ========================================== */
  .message-content {
    max-width: 100%;
    font-size: 0.875rem;
    line-height: 1.5;
  }

  .message-content h1,
  .message-content h2,
  .message-content h3,
  .message-content h4,
  .message-content h5,
  .message-content h6 {
    margin-top: 0.5em;
    margin-bottom: 0.2em;
    font-weight: 600;
    line-height: 1.25;
    color: #1a1a1a;
  }

  [data-theme="dark"] .message-content h1,
  [data-theme="dark"] .message-content h2,
  [data-theme="dark"] .message-content h3,
  [data-theme="dark"] .message-content h4,
  [data-theme="dark"] .message-content h5,
  [data-theme="dark"] .message-content h6 {
    color: #f5f5f5;
  }

  .message-content h1 { font-size: 1.5em; }
  .message-content h2 { font-size: 1.3em; }
  .message-content h3 { font-size: 1.15em; }
  .message-content h4 { font-size: 1.05em; }
  .message-content h5 { font-size: 1em; }
  .message-content h6 { font-size: 0.95em; }

  .message-content p {
    margin: 0.25em 0;
    line-height: 1.4;
  }

  .message-content p + p {
    margin-top: 0.5em;
  }

  .message-content h1 + ul,
  .message-content h2 + ul,
  .message-content h3 + ul,
  .message-content h4 + ul,
  .message-content h5 + ul,
  .message-content h6 + ul,
  .message-content h1 + ol,
  .message-content h2 + ol,
  .message-content h3 + ol,
  .message-content h4 + ol,
  .message-content h5 + ol,
  .message-content h6 + ol {
    margin-top: 0.1em;
  }

  .message-content > *:first-child {
    margin-top: 0 !important;
  }

  .message-content > *:last-child {
    margin-bottom: 0 !important;
  }

  /* Code styling */
  .message-content code {
    background-color: rgba(0, 0, 0, 0.08);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.9em;
    font-family: monospace;
    color: #1a1a1a;
  }

  [data-theme="dark"] .message-content code {
    background-color: rgba(255, 255, 255, 0.1);
    color: #f5f5f5;
  }

  .message-content pre:not(.mermaid) {
    background-color: rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 0.5rem;
    padding: 0.625rem;
    overflow-x: auto;
    margin: 0.4em 0;
  }

  [data-theme="dark"] .message-content pre:not(.mermaid) {
    background-color: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
  }

  .message-content pre code {
    background-color: transparent;
    padding: 0;
    border-radius: 0;
    font-size: 0.85em;
    line-height: 1.5;
  }

  /* Code block with copy button */
  .message-content .code-block-wrapper {
    margin: 0.4em 0;
    display: block;
  }

  .message-content .code-block-wrapper pre {
    margin: 0;
    display: block;
    position: relative;
  }

  .message-content .code-block-wrapper .code-copy-btn {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: rgba(0, 0, 0, 0.75);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.95);
    cursor: pointer;
    padding: 0.375rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.375rem;
    transition: all 0.15s ease;
    opacity: 0;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  .message-content .code-block-wrapper:hover .code-copy-btn {
    opacity: 1;
  }

  .message-content .code-copy-btn:hover {
    background-color: rgba(0, 0, 0, 0.85);
    color: rgba(255, 255, 255, 1);
    transform: scale(1.05);
  }

  [data-theme="dark"] .message-content .code-copy-btn {
    background: rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.95);
  }

  [data-theme="dark"] .message-content .code-copy-btn:hover {
    background-color: rgba(255, 255, 255, 0.3);
    color: rgba(255, 255, 255, 1);
  }

  .message-content .code-copy-btn.copied {
    color: #10b981;
    opacity: 1;
  }

  [data-theme="dark"] .message-content .code-copy-btn.copied {
    color: #34d399;
  }

  .message-content .code-copy-btn svg {
    width: 16px;
    height: 16px;
    stroke-width: 2;
  }

  /* Lists */
  .message-content ul {
    margin: 0.15em 0;
    padding-left: 1.5rem;
    line-height: 1.35;
    list-style-type: disc;
    list-style-position: outside;
  }

  .message-content ol {
    margin: 0.15em 0;
    padding-left: 1.5rem;
    line-height: 1.35;
    list-style-type: decimal;
    list-style-position: outside;
  }

  .message-content ul ul {
    list-style-type: circle;
    margin: 0 0 0.02em 0;
  }

  .message-content ul ul ul {
    list-style-type: square;
    margin: 0 0 0.02em 0;
  }

  .message-content ol ol {
    list-style-type: lower-alpha;
    margin: 0 0 0.02em 0;
  }

  .message-content ol ol ol {
    list-style-type: lower-roman;
    margin: 0 0 0.02em 0;
  }

  .message-content ol ul,
  .message-content ul ol {
    margin: 0 0 0.02em 0;
  }

  .message-content li {
    margin: 0.02em 0;
    padding-left: 0.2em;
    display: list-item;
  }

  .message-content li li {
    margin: 0.01em 0;
  }

  .message-content li > ul,
  .message-content li > ol {
    margin: 0 0 0.02em 0;
    margin-top: 0;
  }

  /* Blockquotes */
  .message-content blockquote {
    border-left: 3px solid rgba(0, 0, 0, 0.2);
    margin: 0.4em 0;
    padding: 0.4em 0.8em;
    background-color: rgba(0, 0, 0, 0.02);
    font-style: italic;
    color: #6b7280;
  }

  [data-theme="dark"] .message-content blockquote {
    background-color: rgba(255, 255, 255, 0.02);
    border-left-color: rgba(255, 255, 255, 0.2);
    color: #a0a0a0;
  }

  /* Links */
  .message-content a {
    color: #0066cc;
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 150ms;
  }

  .message-content a:hover {
    border-bottom-color: #0066cc;
  }

  [data-theme="dark"] .message-content a {
    color: #3b82f6;
  }

  [data-theme="dark"] .message-content a:hover {
    border-bottom-color: #3b82f6;
  }

  /* Tables */
  .message-content table {
    border-collapse: collapse;
    width: 100%;
    margin: 0.4em 0;
    font-size: 0.9em;
  }

  .message-content th,
  .message-content td {
    border: 1px solid #e5e7eb;
    padding: 0.5rem 0.75rem;
    text-align: left;
  }

  [data-theme="dark"] .message-content th,
  [data-theme="dark"] .message-content td {
    border-color: #333333;
  }

  .message-content th {
    background-color: rgba(0, 0, 0, 0.05);
    font-weight: 600;
  }

  [data-theme="dark"] .message-content th {
    background-color: rgba(255, 255, 255, 0.05);
  }

  /* Images */
  .message-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5rem;
    margin: 0.5em 0;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  [data-theme="dark"] .message-content img {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  /* Horizontal rule */
  .message-content hr {
    border: 0;
    border-top: 1px solid #e5e7eb;
    margin: 0.4em 0;
  }

  [data-theme="dark"] .message-content hr {
    border-top-color: #333333;
  }

  /* Strong/bold text */
  .message-content strong {
    font-weight: 600;
    color: #1a1a1a;
  }

  [data-theme="dark"] .message-content strong {
    color: #f5f5f5;
  }

  /* Task lists (checkboxes) */
  .message-content input[type="checkbox"] {
    margin-right: 0.5em;
    vertical-align: middle;
    cursor: default;
  }

  .message-content li:has(> input[type="checkbox"]) {
    list-style-type: none;
    margin-left: -1.5rem;
  }

  /* Mermaid diagrams */
  .message-content .mermaid-wrapper {
    margin: 0.5rem 0;
    padding: 1rem;
    background-color: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 0.5rem;
    overflow-x: auto;
    min-height: 100px;
  }

  [data-theme="dark"] .message-content .mermaid-wrapper {
    background-color: #1e293b;
    border-color: rgba(255, 255, 255, 0.1);
  }

  .message-content .mermaid-wrapper svg {
    display: block;
    max-width: 100%;
    height: auto;
  }

  /* Spacing adjustments for different content combinations */
  .message-content p + ul,
  .message-content p + ol {
    margin-top: 0.25em;
  }

  .message-content ul + p,
  .message-content ol + p {
    margin-top: 0.25em;
  }

  .message-content li pre {
    margin-top: 0.2em;
    margin-bottom: 0.2em;
  }

  .message-content li > pre:first-child {
    margin-top: 0.1em;
  }

  .message-content li p + pre {
    margin-top: 0.15em;
  }

  .message-content p + pre {
    margin-top: 0.3em;
  }

  .message-content pre + p {
    margin-top: 0.3em;
  }

  .message-content h1 + pre,
  .message-content h2 + pre,
  .message-content h3 + pre,
  .message-content h4 + pre,
  .message-content h5 + pre,
  .message-content h6 + pre {
    margin-top: 0.2em;
  }
}

/* Base styles */
@layer base {
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow: hidden;
    transition: all 300ms;
  }

  /* Background colors for welcome vs chat view */
  body.view-welcome {
    background: #f8f8f6;
  }

  body.view-chat {
    background: white;
  }

  [data-theme="dark"] body.view-welcome {
    background: #1e2432;
  }

  [data-theme="dark"] body.view-chat {
    background: #1f2937;
  }

  /* Placeholder text for empty states (files, sessions) */
  .files-loading,
  .files-empty,
  .files-error,
  .sessions-loading {
    @apply p-4 text-center text-sm text-gray-400;
  }

  [data-theme="dark"] .files-loading,
  [data-theme="dark"] .files-empty,
  [data-theme="dark"] .files-error,
  [data-theme="dark"] .sessions-loading {
    @apply text-gray-400;
  }

  .files-error {
    @apply text-red-500;
  }

  [data-theme="dark"] .files-error {
    @apply text-red-400;
  }
}
