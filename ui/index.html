<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'wasm-unsafe-eval';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: blob: https://www.google.com https://*.gstatic.com;
    font-src 'self' data:;
    connect-src 'self';
    media-src 'self';
    object-src 'none';
    base-uri 'self';
    form-action 'self';
  ">
  <title>Chat Juicer</title>
  <!-- Styles will be bundled by Vite -->
  <link rel="stylesheet" href="input.css">
</head>
<body class="view-welcome" data-theme="dark">
  <!-- macOS drag handle (hidden on Windows/Linux where custom titlebar is used) -->
  <div class="macos-drag-handle"></div>

  <!-- Toast notifications container -->
  <div id="toast-container" class="fixed top-4 left-1/2 -translate-x-1/2 z-[9999] flex flex-col gap-2 pointer-events-none"></div>

  <div class="w-full h-screen relative overflow-hidden">
    <!-- Top Bar Controls (above title bar drag region) -->
    <div class="absolute left-[85px] top-0.5 flex items-center gap-1 z-[10001] [.sidebar.collapsed~&]:left-0">
      <!-- Sidebar Toggle Button -->
      <button class="bg-transparent cursor-pointer p-2 rounded-lg transition-all duration-200 text-gray-600 dark:text-gray-400 hover:bg-surface-hover hover:text-gray-800 dark:hover:text-gray-200 [.sidebar.collapsed~&]:bg-surface-2 [.sidebar.collapsed~&]:shadow-md" id="sidebar-toggle" title="Toggle sidebar">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <line x1="9" y1="3" x2="9" y2="21"/>
        </svg>
      </button>
      <!-- Settings Button -->
      <button class="bg-transparent cursor-pointer p-2 rounded-lg transition-all duration-200 text-gray-600 dark:text-gray-400 hover:bg-surface-hover hover:text-gray-800 dark:hover:text-gray-200" id="settings-btn" title="Settings">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </button>
      <!-- Restart Button -->
      <button class="bg-transparent cursor-pointer p-2 rounded-lg transition-all duration-200 text-gray-600 dark:text-gray-400 hover:bg-surface-hover hover:text-gray-800 dark:hover:text-gray-200" id="restart-btn" title="Restart bot">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
          <path d="M3 3v5h5"/>
        </svg>
      </button>
    </div>

    <!-- Sidebar (overlay mode) -->
    <div class="absolute left-0 top-0 bottom-0 w-[260px] bg-surface-1 border-r border-primary flex flex-col transition-transform duration-300 z-[300] shadow-lg [&.collapsed]:-translate-x-full collapsed" id="sidebar">
      <!-- New Chat Button -->
      <button class="mx-3 mt-12 mb-3 py-3 px-4 bg-transparent border border-[var(--color-border-primary)] rounded-lg cursor-pointer text-sm font-medium text-gray-800 dark:text-gray-100 flex items-center gap-2 transition-all duration-200 hover:bg-[var(--color-surface-hover)] hover:border-[var(--color-brand-primary)]" id="new-session-btn" title="New conversation">
        <span class="text-lg font-light">+</span>
        <span>New chat</span>
      </button>

      <!-- Sessions List -->
      <div class="flex-1 overflow-y-auto px-2 pb-3 sessions-scrollbar" id="sessions-list">
        <div class="sessions-loading">Loading sessions...</div>
      </div>
    </div>

    <!-- Files Panel (overlay mode) -->
    <div class="absolute right-0 top-0 bottom-0 w-[420px] flex flex-col bg-surface-1 border-l border-primary transition-transform duration-300 z-[300] shadow-lg files-panel [&.collapsed]:translate-x-full collapsed" id="files-panel">
      <div class="px-5 pt-4 bg-surface-1 relative z-[10001]">
        <div class="file-panel-tabs">
          <button class="file-panel-tab active" id="tab-sources" data-directory="sources">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M4 11V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-1"/>
              <path d="M14 2v5a1 1 0 0 0 1 1h5"/>
              <path d="M2 15h10"/>
              <path d="m9 18 3-3-3-3"/>
            </svg>
            Input
          </button>
          <button class="file-panel-tab" id="tab-output" data-directory="output">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M4.226 20.925A2 2 0 0 0 6 22h12a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v3.127"/>
              <path d="M14 2v5a1 1 0 0 0 1 1h5"/>
              <path d="m5 11-3 3"/>
              <path d="m5 17-3-3h10"/>
            </svg>
            Output
          </button>
        </div>
      </div>
      <div class="flex-1 overflow-y-auto p-4 transition-opacity duration-300 flex flex-col gap-2 custom-scrollbar [contain:layout_style_paint]" id="files-container">
        <div class="files-loading">Loading files...</div>
      </div>
    </div>

    <!-- Main Content Area (full width, panels overlay on top) -->
    <div class="absolute inset-0 flex flex-col overflow-hidden">
      <!-- Welcome Page (shown on startup) -->
      <div id="welcome-page-container"></div>

      <!-- Minimal Header (hidden on welcome page) -->
      <div class="bg-surface-1 border-b border-secondary h-14 px-5 flex items-center justify-end [.view-welcome_&]:hidden" id="chat-header">
        <!-- Files Panel Toggle (shows when panel is collapsed) -->
        <div class="transition-all duration-300 flex items-center z-[10001] relative" id="files-panel-toggle-wrapper">
          <button class="bg-transparent cursor-pointer py-1.5 px-2.5 rounded-md transition-all duration-200 text-gray-700 dark:text-gray-300 text-lg flex items-center justify-center whitespace-nowrap hover:bg-surface-hover hover:text-gray-900 dark:hover:text-gray-100" id="open-files-btn" title="Show files panel">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Content Wrapper (chat + tools side by side) -->
      <div class="flex flex-1 flex-row overflow-hidden relative items-stretch">
        <!-- File upload drop zone (covers entire content area) -->
        <div class="absolute top-0 left-0 right-0 bottom-0 bg-surface-overlay border-[3px] border-dashed border-secondary hidden items-center justify-center z-[1000] pointer-events-none backdrop-blur-sm animate-fadeIn [&.active]:flex" id="file-drop-zone">
          <div class="text-center text-xl text-gray-700 dark:text-gray-300 font-semibold pointer-events-none">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="mb-4 animate-bounce text-gray-700 dark:text-gray-300" aria-hidden="true">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
              <path d="M12 11v6m-3-3l3 3 3-3"/>
            </svg>
            <span class="block text-lg tracking-wide">Drop files here to upload to sources/</span>
          </div>
        </div>

        <!-- File upload progress bar (visible on both welcome and chat views) -->
        <div class="absolute top-5 left-1/2 -translate-x-1/2 w-[400px] max-w-[calc(100%-40px)] bg-surface-2 border border-primary rounded-xl p-4 z-[900] shadow-lg opacity-0 invisible transition-opacity duration-200 [&.active]:opacity-100 [&.active]:visible" id="file-upload-progress">
          <div class="flex items-center gap-3 mb-2">
            <div class="flex-1 h-2 bg-surface-1 rounded overflow-hidden">
              <div class="h-full bg-brand-primary rounded transition-all duration-300 w-0" id="progress-bar-fill"></div>
            </div>
          </div>
          <div class="text-sm text-secondary text-center" id="progress-text">Uploading files...</div>
        </div>

        <div class="flex-1 flex flex-col min-w-[400px] chat-panel">

          <div class="flex-1 overflow-y-auto p-5 bg-surface-1 custom-scrollbar [contain:strict]" id="chat-container">
          </div>

          <div class="p-5 bg-surface-1 border-t border-secondary relative">
            <!-- Queued messages container - absolutely positioned above input, transparent to see content behind -->
            <div class="hidden absolute bottom-full left-0 right-0 px-5 pb-2" id="queued-messages-container">
            </div>
            <!-- Chat Input Section (compact variant) -->
            <div class="welcome-input-section compact">
              <textarea
                id="user-input"
                placeholder="Reply..."
                autocomplete="off"
                rows="1"
                class="welcome-input"
              ></textarea>
              <div class="welcome-input-footer">
                <div></div>
                <!-- Chat Model Selector -->
                <div id="chat-model-selector"></div>
                <button class="welcome-send-btn" id="send-btn" title="Send message">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Load the modular architecture -->
  <script type="module" src="../electron/renderer/index.js"></script>
</body>
</html>
