<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: blob:;
    font-src 'self' data:;
    connect-src 'self';
    media-src 'self';
    object-src 'none';
    base-uri 'self';
    form-action 'self';
  ">
  <title>Wishgate</title>
  <!-- Styles will be bundled by Vite -->
  <link rel="stylesheet" href="input.css">
</head>
<body class="view-welcome">
  <!-- macOS drag handle (hidden on Windows/Linux where custom titlebar is used) -->
  <div class="macos-drag-handle"></div>

  <!-- Toast notifications container -->
  <div id="toast-container" class="fixed top-4 left-1/2 -translate-x-1/2 z-[9999] flex flex-col gap-2 pointer-events-none"></div>

  <div class="bg-white dark:bg-gray-800 w-full h-screen relative overflow-hidden">
    <!-- Sidebar Toggle Button (overlays sidebar edge) -->
    <button class="absolute left-[85px] top-0.5 bg-transparent border-none cursor-pointer p-2 rounded-lg transition-all duration-300 text-gray-600 dark:text-gray-400 z-[10001] hover:bg-gray-100/50 dark:hover:bg-gray-800/50 [.sidebar.collapsed~&]:left-0 [.sidebar.collapsed~&]:bg-white [.sidebar.collapsed~&]:dark:bg-gray-800 [.sidebar.collapsed~&]:shadow-md" id="sidebar-toggle" title="Toggle sidebar">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <line x1="9" y1="3" x2="9" y2="21"/>
      </svg>
    </button>

    <!-- Sidebar (overlay mode) -->
    <div class="absolute left-0 top-0 bottom-0 w-[260px] bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 flex flex-col transition-transform duration-300 z-[300] shadow-lg [&.collapsed]:-translate-x-full collapsed" id="sidebar">
      <!-- New Chat Button -->
      <button class="mx-3 mt-12 mb-3 py-3 px-4 bg-transparent border border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer text-sm font-medium text-gray-800 dark:text-gray-100 flex items-center gap-2 transition-all duration-200 hover:bg-gray-50 dark:hover:bg-gray-900 hover:border-blue-600 dark:hover:border-blue-600" id="new-session-btn" title="New conversation">
        <span class="text-lg font-light">+</span>
        <span>New chat</span>
      </button>

      <!-- Sessions List -->
      <div class="flex-1 overflow-y-auto px-2 sessions-scrollbar" id="sessions-list">
        <div class="sessions-loading">Loading sessions...</div>
      </div>

      <!-- Sidebar Footer (Settings) -->
      <div class="border-t border-gray-200 dark:border-gray-600 p-2">
        <button class="w-full py-2.5 px-3 bg-transparent border-none rounded-md cursor-pointer text-sm text-gray-800 dark:text-gray-100 flex items-center gap-2.5 transition-colors hover:bg-gray-50 dark:hover:bg-gray-900 text-left" id="theme-toggle" title="Toggle dark mode">
          <span class="w-5 flex items-center justify-center" id="theme-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
          </span>
          <span class="flex-1 text-sm" id="theme-text">Dark mode</span>
        </button>
        <div class="w-full py-2.5 px-3 bg-transparent border-none rounded-md text-sm text-gray-800 dark:text-gray-100 flex items-center gap-2.5 text-left cursor-default">
          <div class="w-2.5 h-2.5 rounded-full bg-emerald-500 dark:bg-emerald-500 animate-pulse" id="status-indicator"></div>
          <span class="flex-1 text-sm" id="status-text">Connected</span>
        </div>
        <button class="w-full py-2.5 px-3 bg-transparent border-none rounded-md cursor-pointer text-sm text-gray-800 dark:text-gray-100 flex items-center gap-2.5 transition-colors hover:bg-gray-50 dark:hover:bg-gray-900 text-left" id="restart-btn" title="Restart bot">
          <span class="w-5 flex items-center justify-center">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 4v6h6M23 20v-6h-6"/>
              <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
            </svg>
          </span>
          <span class="flex-1 text-sm">Restart</span>
        </button>
      </div>
    </div>

    <!-- Main Content Area (full width, panels overlay on top) -->
    <div class="absolute inset-0 flex flex-col overflow-hidden">
      <!-- Welcome Page (shown on startup) -->
      <div id="welcome-page-container"></div>

      <!-- Minimal Header (hidden on welcome page) -->
      <div class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 py-4 px-5 flex items-center justify-end [.view-welcome_&]:hidden" id="chat-header">
        <!-- Files Panel Toggle (shows when panel is collapsed) -->
        <div class="transition-all duration-300 flex items-center z-[200] relative" id="files-panel-toggle-wrapper">
          <button class="bg-transparent border-none cursor-pointer py-1.5 px-2.5 rounded-md transition-all duration-200 text-gray-700 dark:text-gray-300 text-lg flex items-center justify-center whitespace-nowrap hover:bg-gray-100 dark:hover:bg-gray-800 z-[10001]" id="open-files-btn" title="Show files panel">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Content Wrapper (chat + tools side by side) -->
      <div class="flex flex-1 flex-row overflow-hidden relative items-stretch">
        <!-- File upload drop zone (covers entire content area) -->
        <div class="absolute top-0 left-0 right-0 bottom-0 bg-gray-100/50 dark:bg-gray-800/50 border-[3px] border-dashed border-gray-300 dark:border-gray-600 hidden items-center justify-center z-[1000] pointer-events-none backdrop-blur-sm animate-fadeIn [&.active]:flex" id="file-drop-zone">
          <div class="text-center text-xl text-gray-700 dark:text-gray-300 font-semibold pointer-events-none">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="mb-4 animate-bounce text-gray-700 dark:text-gray-300">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
              <path d="M12 11v6m-3-3l3 3 3-3"/>
            </svg>
            <span class="block text-lg tracking-wide">Drop files here to upload to sources/</span>
          </div>
        </div>

        <div class="flex-1 flex flex-col min-w-[400px] border-r border-gray-200 dark:border-gray-600 chat-panel">

          <!-- File upload progress bar -->
          <div class="hidden absolute top-5 left-5 right-5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-xl p-4 z-[900] shadow-lg animate-slideIn [&.active]:block" id="file-upload-progress">
            <div class="w-full h-2 bg-gray-50 dark:bg-gray-900 rounded overflow-hidden mb-2">
              <div class="h-full bg-gray-800 dark:bg-gray-300 rounded transition-all duration-300 w-0" id="progress-bar-fill"></div>
            </div>
            <div class="files-loading" id="progress-text">Uploading files...</div>
          </div>

          <div class="flex-1 overflow-y-auto p-5 bg-gray-50 dark:bg-gray-900 custom-scrollbar [contain:strict]" id="chat-container">
          </div>

          <!-- Legacy typing indicator (kept for compatibility) -->
          <div class="mb-6 px-5 py-0" style="display: none;">
            <div class="flex gap-1 p-2.5 opacity-0 transition-opacity duration-300 [&.active]:opacity-100" id="typing-indicator">
              <span class="w-2 h-2 rounded-full bg-cyan-400 dark:bg-cyan-400 animate-typing"></span>
              <span class="w-2 h-2 rounded-full bg-cyan-400 dark:bg-cyan-400 animate-typing [animation-delay:0.2s]"></span>
              <span class="w-2 h-2 rounded-full bg-cyan-400 dark:bg-cyan-400 animate-typing [animation-delay:0.4s]"></span>
            </div>
          </div>

          <div class="p-5 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-600 flex items-end gap-2.5">
            <div class="flex-1 relative">
              <textarea
                id="user-input"
                placeholder="Reply..."
                autocomplete="off"
                rows="1"
                class="w-full py-3 px-4 border-2 border-gray-200 dark:border-gray-600 rounded-3xl text-base outline-none transition-colors bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 focus:border-gray-400 dark:focus:border-gray-500 disabled:opacity-50 disabled:cursor-not-allowed resize-none overflow-hidden min-h-[48px]"
              ></textarea>
            </div>
            <button class="py-3 px-6 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-900 border-none rounded-3xl text-base font-semibold cursor-pointer transition-all duration-200 hover:bg-gray-700 dark:hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0" id="send-btn">Send</button>
          </div>
        </div>

        <!-- Files Panel (overlay mode) -->
        <div class="absolute right-0 top-0 bottom-0 w-[420px] flex flex-col bg-gray-50 dark:bg-gray-900 transition-transform duration-300 z-[300] shadow-lg files-panel [&.collapsed]:translate-x-full collapsed" id="files-panel">
          <div class="p-4 px-5 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center h-14">
            <div class="flex gap-2 flex-1">
              <button class="bg-transparent border border-gray-200 dark:border-gray-600 rounded-lg py-1.5 px-3 text-gray-600 dark:text-gray-400 text-[13px] font-medium cursor-pointer transition-all duration-200 flex items-center gap-1 whitespace-nowrap hover:bg-gray-100 dark:hover:bg-gray-800 [&.active]:bg-gray-200 dark:[&.active]:bg-gray-700 [&.active]:border-gray-400 dark:[&.active]:border-gray-500 [&.active]:text-gray-900 dark:[&.active]:text-gray-100 [&.active]:font-semibold active" id="tab-sources" data-directory="sources">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                </svg>
                Sources
              </button>
              <button class="bg-transparent border border-gray-200 dark:border-gray-600 rounded-lg py-1.5 px-3 text-gray-600 dark:text-gray-400 text-[13px] font-medium cursor-pointer transition-all duration-200 flex items-center gap-1 whitespace-nowrap hover:bg-gray-100 dark:hover:bg-gray-800 [&.active]:bg-gray-200 dark:[&.active]:bg-gray-700 [&.active]:border-gray-400 dark:[&.active]:border-gray-500 [&.active]:text-gray-900 dark:[&.active]:text-gray-100 [&.active]:font-semibold" id="tab-output" data-directory="output">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <path d="M14 2v6h6M16 13H8m8 4H8m8 4H8"/>
                </svg>
                Output
              </button>
            </div>
            <button class="bg-transparent border border-gray-200 dark:border-gray-600 cursor-pointer py-1.5 px-2 text-gray-600 dark:text-gray-400 text-sm rounded-md transition-all duration-200 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800" id="refresh-files-btn" title="Refresh file list">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 4v6h6M23 20v-6h-6"/>
                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
              </svg>
            </button>
          </div>
          <div class="flex-1 overflow-y-auto p-4 transition-opacity duration-300 flex flex-col gap-2 custom-scrollbar [contain:layout_style_paint]" id="files-container">
            <div class="files-loading">Loading files...</div>
          </div>
        </div>


      </div>
    </div>
  </div>

  <script type="module" src="../electron/renderer/index.js"></script>
</body>
</html>
